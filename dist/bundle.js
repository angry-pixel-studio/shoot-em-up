(()=>{"use strict";var t=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._x=t,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"magnitude",{get:function(){return Math.sqrt(Math.pow(this._x,2)+Math.pow(this._y,2))},enumerable:!1,configurable:!0}),t.prototype.set=function(t,e){this._x=t,this._y=e},t.prototype.copy=function(t){this.set(t.x,t.y)},t.prototype.equals=function(t){return this._x===t.x&&this._y===t.y},t.prototype.clone=function(){return new t(this._x,this._y)},t.prototype.distance=function(t){return Math.sqrt(Math.pow(this._x-t.x,2)+Math.pow(this._y-t.y,2))},t.add=function(t,e,i){return t.set(e.x+i.x,e.y+i.y),t},t.subtract=function(t,e,i){return t.set(e.x-i.x,e.y-i.y),t},t.unit=function(t,e){return 0===e.magnitude?t.set(0,0):t.set(e.x/e.magnitude,e.y/e.magnitude),t},t.normal=function(t,e){return t.set(-e.y,e.x),this.unit(t,t)},t.scale=function(t,e,i){return t.set(e.x*i,e.y*i),t},t.dot=function(t,e){return t.x*e.x+t.y*e.y},t.cross=function(t,e){return t.x*e.y-t.y*e.x},t.round=function(t,e){return t.set(Math.round(e.x),Math.round(e.y)),t},t}(),e=function(){function e(e,i,n,r){this._position=new t,this._center=new t,this._width=0,this._height=0,this.set(e,i,n,r)}return Object.defineProperty(e.prototype,"x",{get:function(){return this._position.x},set:function(t){this._position.set(t,this._position.y)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._position.y},set:function(t){this._position.set(this._position.x,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"x1",{get:function(){return this._position.x+this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y1",{get:function(){return this._position.y+this._height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(t){this._position.set(t.x,t.y)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._center.set(this.x+this.width/2,this.y+this.height/2),this._center},enumerable:!1,configurable:!0}),e.prototype.set=function(t,e,i,n){this._position.set(t,e),this._width=i,this._height=n},e.prototype.equals=function(t){return this.position.equals(t.position)&&this.width===t.width&&this.height===t.height},e.prototype.updateFromRect=function(t){this.set(t.x,t.y,t.width,t.height)},e.prototype.overlappingRectangle=function(t){return this.x1>=t.x&&this.x<=t.x1&&this.y1>=t.y&&this.y<=t.y1},e}(),i=function(t,e){return Math.floor(Math.random()*(e-t))+t},n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function r(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var o,a=function(){return(a=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function s(t,e,i,n){return new(i||(i=Promise))((function(r,o){function a(t){try{h(n.next(t))}catch(t){o(t)}}function s(t){try{h(n.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}h((n=n.apply(t,e||[])).next())}))}function h(t,e){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function c(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),r=0;for(e=0;e<i;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,r++)n[r]=o[a];return n}!function(t){t.Image="Image",t.Audio="Audio",t.Video="Video"}(o||(o={}));var u,l=function(){this.type=null,this.url=null,this.loaded=!1,this.element=null},p=function(){function t(){this.assets=[]}return t.prototype.getAssetsLoaded=function(){return this.assets.reduce((function(t,e){return t&&e.loaded}),!0)},t.prototype.createImage=function(t){var e=this.createAsset(t,o.Image);return e.element=new Image,e.element.src=t,e.element.naturalWidth?e.loaded=!0:e.element.addEventListener("load",(function(){return e.loaded=!0})),e.element},t.prototype.createAudio=function(t){var e=this.createAsset(t,o.Audio);return e.element=new Audio,e.element.src=t,e.element.duration?e.loaded=!0:e.element.addEventListener("canplaythrough",(function(){return e.loaded=!0})),e.element},t.prototype.createVideo=function(t){var e=this.createAsset(t,o.Video);return e.element=document.createElement("video"),e.element.src=t,e.element.duration?e.loaded=!0:e.element.addEventListener("canplaythrough",(function(){return e.loaded=!0})),e.element},t.prototype.getImage=function(t){return this.getAsset(t,o.Image)},t.prototype.getVideo=function(t){return this.getAsset(t,o.Video)},t.prototype.getAudio=function(t){return this.getAsset(t,o.Audio)},t.prototype.getAsset=function(t,e){return void 0===e&&(e=null),this.assets.reduce((function(i,n){return n.url!==t||null!==e&&e!==n.type?i:n}),null).element},t.prototype.createAsset=function(t,e){var i=new l;return i.type=e,i.url=t,this.assets.push(i),i},t}();!function(t){t[t.Image=0]="Image",t[t.Text=1]="Text",t[t.Geometric=2]="Geometric",t[t.Collider=3]="Collider",t[t.Tilemap=4]="Tilemap"}(u||(u={}));var d,f=function(){function e(){this.ui=!1,this.debug=!1,this.layer=null,this._position=new t(0,0),this._positionInViewport=new t(0,0)}return Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(t){this._position.set(t.x,t.y)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"positionInViewport",{get:function(){return this._positionInViewport},set:function(t){this._positionInViewport.set(t.x,t.y)},enumerable:!1,configurable:!0}),e}(),g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=u.Geometric,e.color=null,e.geometricType=null,e.geometric=null,e}return r(e,t),e.prototype.getGeometric=function(){return this.geometric},e}(f),m=function(t){function e(i){var n=t.call(this,e.messagePrefix+": "+i)||this;return n.name="MiniEngineException",n}return r(e,t),e.messagePrefix="MiniEngine Exception",e}(Error),y=function(){function i(i,n,r,o){void 0===r&&(r=6),void 0===o&&(o=15),this._bounds=new e(0,0,0,0),this._quadrants=[],this.colliders=[],this.sw=0,this.se=1,this.nw=2,this.ne=3,this.center=new t,this.childrenWidth=0,this.childrenHeight=0,this.quadrantsForCollider=[],this.level=i,this._bounds.updateFromRect(n),this.maxLevels=r,this.maxColliders=o,this.updateCache()}return Object.defineProperty(i.prototype,"bounds",{get:function(){return this._bounds},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"quadrants",{get:function(){return this._quadrants},enumerable:!1,configurable:!0}),i.prototype.updateBounds=function(t){this._bounds.updateFromRect(t),this.updateCache()},i.prototype.clearColliders=function(){this.colliders=[],this._quadrants.forEach((function(t){return t.clearColliders()}))},i.prototype.clearQuadrants=function(){this._quadrants.forEach((function(t){return t.clearQuadrants()})),this._quadrants=[]},i.prototype.addCollider=function(t){this._quadrants.length>0?this.insertColliderIntoChildrenQuads(t):(this.colliders.push(t),this.colliders.length>this.maxColliders&&this.level<this.maxLevels&&this.splitQuad())},i.prototype.retrieve=function(t){var e=[];this._quadrants.length>0&&this.getChildrenQuadrantForCollider(t).forEach((function(i){return e.push.apply(e,i.retrieve(t))})),e.push.apply(e,this.colliders);var i=e.indexOf(t);return-1!==i&&e.splice(i,1),e},i.prototype.splitQuad=function(){var t=this;this._quadrants=[new e(this.center.x-this.childrenWidth,this.center.y-this.childrenHeight,this.childrenWidth,this.childrenHeight),new e(this.center.x,this.center.y-this.childrenHeight,this.childrenWidth,this.childrenHeight),new e(this.center.x-this.childrenWidth,this.center.y,this.childrenWidth,this.childrenHeight),new e(this.center.x,this.center.y,this.childrenWidth,this.childrenHeight)].map((function(e){return new i(t.level+1,e,t.maxLevels,t.maxColliders)}));for(var n=0,r=this.colliders;n<r.length;n++){var o=r[n];this.insertColliderIntoChildrenQuads(o)}this.colliders=[]},i.prototype.getChildrenQuadrantForCollider=function(t){if(0===this._quadrants.length)throw new m("Current quadrant does not have quadrant children.");if(this.quadrantsForCollider=[],t.bottomLeftQuadVertex.x<=this.center.x&&t.bottomLeftQuadVertex.y<=this.center.y&&this.quadrantsForCollider.push(this._quadrants[this.sw]),t.bottomRightQuadVertex.x>=this.center.x&&t.bottomRightQuadVertex.y<=this.center.y&&this.quadrantsForCollider.push(this._quadrants[this.se]),t.topLeftQuadVertex.x<=this.center.x&&t.topLeftQuadVertex.y>=this.center.y&&this.quadrantsForCollider.push(this._quadrants[this.nw]),t.topRightQuadVertex.x>=this.center.x&&t.topRightQuadVertex.y>=this.center.y&&this.quadrantsForCollider.push(this._quadrants[this.ne]),0===this.quadrantsForCollider.length)throw new m("Children does not fit in any children quadrant");return this.quadrantsForCollider},i.prototype.insertColliderIntoChildrenQuads=function(t){this.getChildrenQuadrantForCollider(t).forEach((function(e){return e.addCollider(t)}))},i.prototype.updateCache=function(){this.center.set(this._bounds.width/2+this._bounds.x,this._bounds.height/2+this._bounds.y),this.childrenWidth=this._bounds.width/2,this.childrenHeight=this._bounds.height/2},i}(),b=function(){function i(i,n,r,o,a,s){void 0===r&&(r=null),void 0===s&&(s=!1),this.minBounds=new t,this.maxBounds=new t,this.newBounds=new e(0,0,0,0),this.fixedQuadTree=null!==r,this.resolver=i,this.debug=s,this.renderManager=n,this.colliders=[],this.fixedQuadTree?this.bounds=r:this.bounds=new e(0,0,0,0),this.quadTree=new y(0,this.bounds,o,a)}return i.prototype.addCollider=function(t){this.colliders.push(t)},i.prototype.removeCollider=function(t){var e=this.colliders.indexOf(t);-1!==e&&(delete this.colliders[e],this.colliders.splice(e,1))},i.prototype.getCollisionsForCollider=function(t){return-1===this.colliders.indexOf(t)?[]:this.narrowPhase(t,this.broadPhase(t))},i.prototype.broadPhase=function(t){return this.quadTree.retrieve(t)},i.prototype.narrowPhase=function(t,e){var i=this,n=[];return e.filter((function(e){return e.gameObject!==t.gameObject})).forEach((function(e){var r=i.resolver.getCollisionData(t.shape,e.shape);null!==r&&n.push({localCollider:t,remoteCollider:e,collisionData:r})})),n},i.prototype.update=function(){if(0!==this.colliders.length){this.quadTree.clearColliders(),this.quadTree.clearQuadrants(),!1===this.fixedQuadTree&&(this.updateNewBounds(),!1===this.newBounds.equals(this.bounds)&&(this.bounds.updateFromRect(this.newBounds),this.quadTree.updateBounds(this.bounds)));for(var t=0,e=this.colliders;t<e.length;t++){var i=e[t];this.quadTree.addCollider(i)}this.debug&&this.debugQuads(this.quadTree)}},i.prototype.updateNewBounds=function(){var t=this;this.colliders.forEach((function(e){t.minBounds.set(Math.min(e.bottomLeftQuadVertex.x,t.minBounds.x),Math.min(e.bottomLeftQuadVertex.y,t.minBounds.y)),t.maxBounds.set(Math.max(e.topRightQuadVertex.x,t.maxBounds.x),Math.max(e.topRightQuadVertex.y,t.maxBounds.y))})),this.newBounds.set(this.minBounds.x,this.minBounds.y,this.maxBounds.x-this.minBounds.x,this.maxBounds.y-this.minBounds.y)},i.prototype.debugQuads=function(e){for(var i=0,n=e.quadrants;i<n.length;i++){var r=n[i];this.debugQuads(r)}if(!(e.quadrants.length>0)){var o=new g;o.debug=!0,o.position=new t(e.bounds.x+e.bounds.width/2,e.bounds.y+e.bounds.height/2),o.layer="QuadTree",o.geometric=e.bounds,o.geometricType="Rectangle",o.color="#0000FF",this.renderManager.addRenderData(o)}},i}(),v=function(){function t(t,e,i){if(this._canvas=null,!t)throw new m("containerNode cannot be empty or null.");this.containerNode=t,this.gameWidth=e,this.gameHeight=i,this.setupCanvas()}return Object.defineProperty(t.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),t.prototype.setupCanvas=function(){this._canvas=document.createElement("canvas"),this._canvas.id="miniEngineGameCanvas",this._canvas.width=Math.floor(this.gameWidth),this._canvas.height=Math.floor(this.gameHeight),this.canvas.tabIndex=0,this._canvas.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this.containerNode.appendChild(this._canvas),this.canvas.focus()},t}(),x=function(){function t(){this.gameObjects=[]}return t.prototype.addGameObject=function(t,e,i){if(void 0===i&&(i=null),this.findGameObjectByName(e))throw new m("There is already a GameObject with the name "+e);var n=t();return n.name=e,n.parent=i,this.gameObjects.push(n),n},t.prototype.getGameObjects=function(){return this.gameObjects},t.prototype.findGameObjectById=function(t){return this.gameObjects.reduce((function(e,i){return i.id===t?i:e}),null)},t.prototype.findGameObjectByName=function(t){return this.gameObjects.reduce((function(e,i){return i.name===t?i:e}),null)},t.prototype.findGameObjectsByParent=function(t){return this.gameObjects.filter((function(e){return e.parent===t}))},t.prototype.findGameObjectByParentAndName=function(t,e){return this.gameObjects.reduce((function(i,n){return n.name===e&&n.parent===t?n:i}),null)},t.prototype.findGameObjectsByTag=function(t){return this.gameObjects.filter((function(e){return e.tag===t}))},t.prototype.findGameObjectByTag=function(t){var e;return null!==(e=this.findGameObjectsByTag(t)[0])&&void 0!==e?e:null},t.prototype.destroyAllGameObjects=function(){var t=this;this.gameObjects.forEach((function(e){return t._destroyGameObject(e,!1)})),this.gameObjects=[]},t.prototype.destroyGameObject=function(t){this._destroyGameObject(t,!0)},t.prototype._destroyGameObject=function(t,e){var i=this.gameObjects.indexOf(t);-1!==i&&(e&&this.destroyChildren(t),t.destroy(),delete this.gameObjects[i])},t.prototype.destroyChildren=function(t){var e=this;this.findGameObjectsByParent(t).forEach((function(t){e.destroyChildren(t),e.destroyGameObject(t)}))},t}(),w=function(){function t(){var t=this;this.gamepads=new Map,this.eventHandler=function(e){"gamepadconnected"===e.type?t.gamepadConnected(e.gamepad):"gamepaddisconnected"===e.type&&t.gamepadDisconected(e.gamepad)},window.addEventListener("gamepadconnected",this.eventHandler),window.addEventListener("gamepaddisconnected",this.eventHandler),window.addEventListener(ft,(function(){return t.update()}))}return t.prototype.getGamepad=function(t){var e;return null!==(e=this.gamepads.get(t))&&void 0!==e?e:null},t.prototype.gamepadConnected=function(t){this.gamepads.set(t.index,new _),this.gamepads.get(t.index).updateFromGamepad(t)},t.prototype.gamepadDisconected=function(t){this.gamepads.delete(t.index)},t.prototype.update=function(){for(var t=0,e=navigator.getGamepads();t<e.length;t++){var i=e[t];null!==i&&(!1===this.gamepads.has(i.index)&&this.gamepadConnected(i),this.gamepads.get(i.index).updateFromGamepad(i))}},t}(),_=function(){function t(){this._connected=!1,this._id=null,this.buttons=new Map,this.axes=new Map}return t.prototype.updateFromGamepad=function(t){var e=this;this._id=t.id,this._connected=t.connected,t.buttons.forEach((function(t,i){return e.buttons.set(i,t.pressed)})),t.axes.forEach((function(t,i){return e.axes.set(i,t)}))},t.prototype.getButtonPressed=function(t){return this.buttons.get(t)},t.prototype.getAxis=function(t){return this.axes.get(t)},Object.defineProperty(t.prototype,"connected",{get:function(){return this._connected},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dpadUp",{get:function(){var t;return null!==(t=this.buttons.get(12))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dpadDown",{get:function(){var t;return null!==(t=this.buttons.get(13))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dpadLeft",{get:function(){var t;return null!==(t=this.buttons.get(14))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dpadRight",{get:function(){var t;return null!==(t=this.buttons.get(15))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottomFace",{get:function(){var t;return null!==(t=this.buttons.get(0))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightFace",{get:function(){var t;return null!==(t=this.buttons.get(1))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftFace",{get:function(){var t;return null!==(t=this.buttons.get(2))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"topFace",{get:function(){var t;return null!==(t=this.buttons.get(3))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftShoulder",{get:function(){var t;return null!==(t=this.buttons.get(4))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightShoulder",{get:function(){var t;return null!==(t=this.buttons.get(5))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftTrigger",{get:function(){var t;return null!==(t=this.buttons.get(6))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){var t;return null!==(t=this.buttons.get(7))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"back",{get:function(){var t;return null!==(t=this.buttons.get(8))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"start",{get:function(){var t;return null!==(t=this.buttons.get(9))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftStickButton",{get:function(){var t;return null!==(t=this.buttons.get(10))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightStickButton",{get:function(){var t;return null!==(t=this.buttons.get(11))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftStickHorizontal",{get:function(){var t;return null!==(t=this.axes.get(0))&&void 0!==t?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftStickVertical",{get:function(){var t;return null!==(t=-this.axes.get(1))&&void 0!==t?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightStickHorizontal",{get:function(){var t;return null!==(t=this.axes.get(2))&&void 0!==t?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightStickVertical",{get:function(){var t;return null!==(t=-this.axes.get(3))&&void 0!==t?t:0},enumerable:!1,configurable:!0}),t}(),O=function(t,e,i,n){this.mouse=t,this.keyboard=e,this.gamepad=i,this.touch=n},j=function(){function t(t){var e=this;this.keyPresses=new Map,this.eventHandler=function(t){"keydown"===t.type&&e.keyPresses.set(t.code,!0),"keyup"===t.type&&e.keyPresses.set(t.code,!1)},this.canvas=t,this.canvas.addEventListener("keydown",this.eventHandler),this.canvas.addEventListener("keyup",this.eventHandler)}return t.prototype.isPressed=function(t){var e;return null!==(e=this.keyPresses.get(t))&&void 0!==e&&e},t}(),M=function(){function e(e){this._leftButtonPressed=!1,this._scrollButtonPressed=!1,this._rightButtonPressed=!1,this._positionInViewport=new t(0,0),this._hasMoved=!1,this.lastPositionInViewport=new t(0,0),this.canvas=e,this.setup()}return Object.defineProperty(e.prototype,"leftButtonPressed",{get:function(){return this._leftButtonPressed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scrollButtonPressed",{get:function(){return this._scrollButtonPressed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightButtonPressed",{get:function(){return this._rightButtonPressed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"positionInViewport",{get:function(){return this._positionInViewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasMoved",{get:function(){return this._hasMoved},enumerable:!1,configurable:!0}),e.prototype.setup=function(){var t=this;this.canvas.addEventListener("mousemove",(function(e){return t.updatePosition(e)})),this.canvas.addEventListener("mousedown",(function(e){return t.updateButtonDown(e)})),this.canvas.addEventListener("mouseup",(function(e){return t.updateButtonUp(e)})),window.addEventListener(ft,(function(){return t.update()}))},e.prototype.updateButtonDown=function(t){this.canvas.focus(),t.preventDefault(),t.stopPropagation(),this._leftButtonPressed=0===t.button,this._scrollButtonPressed=1===t.button,this._rightButtonPressed=2===t.button},e.prototype.updateButtonUp=function(t){t.preventDefault(),t.stopPropagation(),this._leftButtonPressed=0!==t.button&&this._leftButtonPressed,this._scrollButtonPressed=1!==t.button&&this._scrollButtonPressed,this._rightButtonPressed=2!==t.button&&this._rightButtonPressed},e.prototype.updatePosition=function(t){t.preventDefault(),t.stopPropagation(),this._positionInViewport.set(t.offsetX/(this.canvas.clientWidth/this.canvas.width)-this.canvas.width/2,-t.offsetY/(this.canvas.clientHeight/this.canvas.height)+this.canvas.height/2)},e.prototype.update=function(){!1===this._positionInViewport.equals(this.lastPositionInViewport)?(this._hasMoved=!0,this.lastPositionInViewport.copy(this._positionInViewport)):this._hasMoved=!1},e}();!function(t){t[t.Rectangle=0]="Rectangle"}(d||(d={}));var P=function(){function e(){this._model=[],this._vertices=[],this._position=new t,this._direction=new t,this._height=0,this._width=0,this._angle=0}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(t){this._position.set(t.x,t.y)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"direction",{get:function(){return this._direction},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vertices",{get:function(){return this._vertices},enumerable:!1,configurable:!0}),e}(),C=function(){function e(e){this.canvas=null,this.canvasContext=null,this.imagePosition=new t(0,0),this.canvas=e,this.canvasContext=e.getContext("2d")}return e.prototype.clearCanvas=function(t){void 0===t&&(t=null),this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height),null!==t&&(this.canvasContext.fillStyle=t,this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height))},e.prototype.render=function(t,e){switch(e.type){case u.Image:this.renderImage(e,t.zoom);break;case u.Tilemap:this.renderTilemap(e,t.zoom);break;case u.Text:this.renderText(e);break;case u.Geometric:this.renderGeometric(e,t.zoom);break;case u.Collider:this.renderCollider(e,t.zoom)}},e.prototype.renderImage=function(t,e){this.updateRenderPosition(t),this.imagePosition.set(0,0),this.canvasContext.save(),this.applyZoom(t,e),0!==t.rotation?(this.canvasContext.translate(t.positionInViewport.x+t.width/2,t.positionInViewport.y+t.height/2),this.imagePosition.set(-t.width/2,-t.height/2),this.canvasContext.rotate(-t.rotation)):(this.canvasContext.translate(t.positionInViewport.x,t.positionInViewport.y),this.imagePosition.set(t.flipHorizontal?-t.width:this.imagePosition.x,t.flipVertical?-t.height:this.imagePosition.y)),this.canvasContext.globalAlpha=t.alpha,this.canvasContext.imageSmoothingEnabled=t.smooth,this.canvasContext.scale(t.flipHorizontal?-1:1,t.flipVertical?-1:1),void 0!==t.slice&&null!==t.slice?this.canvasContext.drawImage(t.image,t.slice.x,t.slice.y,t.slice.width,t.slice.height,this.imagePosition.x,this.imagePosition.y,t.width,t.height):this.canvasContext.drawImage(t.image,this.imagePosition.x,this.imagePosition.y,t.width,t.height),this.canvasContext.restore()},e.prototype.renderTilemap=function(t,e){var i=this;t.tilesToRender.forEach((function(n){i.canvasContext.save(),i.applyZoom(t,e),i.imagePosition.set(0,0),i.canvasContext.translate(i.canvas.width/2+n.positionInViewport.x-t.tileWidth/2,i.canvas.height/2-n.positionInViewport.y-t.tileHeight/2),i.imagePosition.set(n.flipHorizontal?-n.tile.width:i.imagePosition.x,n.flipVertical?-n.tile.height:i.imagePosition.y),i.canvasContext.globalAlpha=t.alpha,i.canvasContext.imageSmoothingEnabled=t.smooth,i.canvasContext.scale(n.flipHorizontal?-1:1,n.flipVertical?-1:1),i.canvasContext.drawImage(t.image,n.tile.x,n.tile.y,n.tile.width,n.tile.height,i.imagePosition.x,i.imagePosition.y,t.tileWidth,t.tileHeight),i.canvasContext.restore()}))},e.prototype.renderText=function(t){var e=this;this.updateRenderPosition(t),this.canvasContext.save(),this.canvasContext.font=t.fontSize+"px "+t.fontFamily,this.canvasContext.fillStyle=t.color,this.canvasContext.textBaseline="middle",this.canvasContext.textAlign=t.pivot,t.text.split("\n").length>1?t.text.split("\n").forEach((function(i,n){e.canvasContext.fillText(i,t.positionInViewport.x,t.positionInViewport.y+(t.lineSeparation+t.fontSize)*n)})):this.canvasContext.fillText(t.text,t.positionInViewport.x,t.positionInViewport.y),this.canvasContext.restore()},e.prototype.renderGeometric=function(t,e){this.canvasContext.save(),this.applyZoom(t,e),this.updateRenderPosition(t),"Rectangle"===t.geometricType&&(this.canvasContext.strokeStyle=t.color,this.canvasContext.strokeRect(t.positionInViewport.x-t.getGeometric().width/2,t.positionInViewport.y-t.getGeometric().height/2,t.getGeometric().width,t.getGeometric().height)),this.canvasContext.restore()},e.prototype.renderCollider=function(t,e){switch(this.canvasContext.save(),this.applyZoom(t,e),this.updateRenderPosition(t),this.canvasContext.beginPath(),this.canvasContext.strokeStyle=t.color,0!==t.shape.angle?(this.canvasContext.translate(t.positionInViewport.x,t.positionInViewport.y),this.canvasContext.rotate(-t.shape.angle),this.imagePosition.set(-t.shape.width/2,-t.shape.height/2)):(this.canvasContext.translate(t.positionInViewport.x-t.shape.width/2,t.positionInViewport.y-t.shape.height/2),this.imagePosition.set(0,0)),t.shape.type){case d.Rectangle:this.canvasContext.strokeRect(this.imagePosition.x,this.imagePosition.y,t.shape.width,t.shape.height)}this.canvasContext.restore()},e.prototype.applyZoom=function(t,e){t.ui||this.canvasContext.setTransform(e,0,0,e,this.canvas.width*(1-e)/2,this.canvas.height*(1-e)/2)},e.prototype.updateRenderPosition=function(t){t.type===u.Image&&this.centerImage(t),t.positionInViewport.set(Number((t.positionInViewport.x+this.canvas.width/2).toFixed(0)),Number((this.canvas.height/2-t.positionInViewport.y).toFixed(0)))},e.prototype.centerImage=function(t){t.positionInViewport.set(t.positionInViewport.x-Math.floor(t.width/2),t.positionInViewport.y+Math.floor(t.height/2))},e}(),R=function(){function t(t,e,i,n){void 0===n&&(n=!1),this.debug=!1,this.renderData=[],this.cameraData=[],this.renderer=t,this.cullingService=e,this.canvasColor=i,this.debug=n}return t.prototype.clearCanvas=function(){this.renderer.clearCanvas(this.canvasColor)},t.prototype.addRenderData=function(t){!1===this.debug&&t.debug||this.renderData.push(t)},t.prototype.addCameraData=function(t){this.cameraData.push(t)},t.prototype.render=function(){var t=this;this.cameraData.sort((function(t,e){return t.depth-e.depth})).forEach((function(e){return t.renderByCamera(e)})),this.clearData()},t.prototype.clearData=function(){this.renderData=[],this.cameraData=[]},t.prototype.renderByCamera=function(t){var e=this;this.orderRendeData(t),this.cullingService.applyCulling(t,this.renderData).forEach((function(i){e.updateFromCameraViewport(t,i),e.renderer.render(t,i)}))},t.prototype.orderRendeData=function(t){this.renderData.sort((function(e,i){return t.layers.indexOf(e.layer)-t.layers.indexOf(i.layer)}))},t.prototype.updateFromCameraViewport=function(t,e){var i=this;!0!==e.ui?e.type===u.Tilemap?e.tilesToRender.forEach((function(e){return i.setPositionInViewport(t,e)})):this.setPositionInViewport(t,e):e.positionInViewport=e.position},t.prototype.setPositionInViewport=function(t,e){e.positionInViewport.set(Math.round(e.position.x-t.worldSpaceRect.x-t.worldSpaceRect.width/2),Math.round(e.position.y-t.worldSpaceRect.y-t.worldSpaceRect.height/2))},t}(),S="undefined"!=typeof Float32Array?Float32Array:Array;function T(){var t=new S(16);return S!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function A(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function E(t,e,i){var n,r,o,a,s,h,c,u,l,p,d,f,g=i[0],m=i[1],y=i[2];return e===t?(t[12]=e[0]*g+e[4]*m+e[8]*y+e[12],t[13]=e[1]*g+e[5]*m+e[9]*y+e[13],t[14]=e[2]*g+e[6]*m+e[10]*y+e[14],t[15]=e[3]*g+e[7]*m+e[11]*y+e[15]):(n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],h=e[5],c=e[6],u=e[7],l=e[8],p=e[9],d=e[10],f=e[11],t[0]=n,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=h,t[6]=c,t[7]=u,t[8]=l,t[9]=p,t[10]=d,t[11]=f,t[12]=n*g+s*m+l*y+e[12],t[13]=r*g+h*m+p*y+e[13],t[14]=o*g+c*m+d*y+e[14],t[15]=a*g+u*m+f*y+e[15]),t}function D(t,e,i){var n=i[0],r=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function B(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],a=e[1],s=e[2],h=e[3],c=e[4],u=e[5],l=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+c*n,t[1]=a*r+u*n,t[2]=s*r+l*n,t[3]=h*r+p*n,t[4]=c*r-o*n,t[5]=u*r-a*n,t[6]=l*r-s*n,t[7]=p*r-h*n,t}function G(t,e,i,n,r,o,a){var s=1/(e-i),h=1/(n-r),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*s,t[13]=(r+n)*h,t[14]=(a+o)*c,t[15]=1,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var F,V=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16)/256,g:parseInt(e[2],16)/256,b:parseInt(e[3],16)/256}:null},I=function(){function t(t,e,i){this.lastTexture=null,this.maskColor=null,this.gl=e.getContext(t),this.programManager=i,this.projectionMatrix=T(),this.modelMatrix=T(),this.textureMatrix=T(),this.posVertices=new Float32Array([-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,.5,.5]),this.texVertices=new Float32Array([0,1,0,0,1,1,1,1,0,0,1,0])}return t.prototype.render=function(t,e,i,n){"image"!==n&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.posVertices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.textureBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.texVertices,this.gl.STATIC_DRAW)),this.modelMatrix=A(this.modelMatrix),E(this.modelMatrix,this.modelMatrix,[i.positionInViewport.x,i.positionInViewport.y,0]),B(this.modelMatrix,this.modelMatrix,i.rotation),D(this.modelMatrix,this.modelMatrix,[i.width*(i.flipHorizontal?-1:1),i.height*(i.flipVertical?-1:1),1]),this.textureMatrix=A(this.textureMatrix),null!==i.slice&&(E(this.textureMatrix,this.textureMatrix,[i.slice.x/i.image.naturalWidth,i.slice.y/i.image.naturalHeight,0]),D(this.textureMatrix,this.textureMatrix,[i.slice.width/i.image.naturalWidth,i.slice.height/i.image.naturalHeight,1])),this.projectionMatrix=A(this.projectionMatrix),G(this.projectionMatrix,t.x,t.x1,t.y,t.y1,-1,1),this.gl.uniformMatrix4fv(this.programManager.projectionMatrixUniform,!1,this.projectionMatrix),this.gl.uniformMatrix4fv(this.programManager.modelMatrixUniform,!1,this.modelMatrix),this.gl.uniformMatrix4fv(this.programManager.textureMatrixUniform,!1,this.textureMatrix),i.alpha<1?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this.lastTexture===e&&"image"===n||(this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(this.programManager.textureUniform,0),this.lastTexture=e),this.gl.uniform1i(this.programManager.renderTextureUniform,1),this.gl.uniform1f(this.programManager.alphaUniform,i.alpha),this.maskColor=null!==i.maskColor?V(i.maskColor):{r:1,g:1,b:1},this.gl.uniform4f(this.programManager.colorUniform,this.maskColor.r,this.maskColor.g,this.maskColor.b,1),this.gl.uniform1f(this.programManager.colorMixUniform,i.maskColorMix),this.gl.drawArrays(this.gl.TRIANGLES,0,6)},t}(),L=function(){function t(t){this.shaderLoader=t}return t.prototype.create=function(t,e,i){var n=t.createProgram(),r=this.shaderLoader.load(t,t.VERTEX_SHADER,e),o=this.shaderLoader.load(t,t.FRAGMENT_SHADER,i);return this.link(t,n,r,o),n},t.prototype.link=function(t,e,i,n){t.attachShader(e,i),t.attachShader(e,n),t.linkProgram(e);var r=t.LINK_STATUS;if(!t.getProgramParameter(e,r)){var o=t.getProgramInfoLog(e);throw t.deleteProgram(e),new m("Unable to initialize the Program: "+o)}},t}(),U=function(){function t(){}return t.prototype.load=function(t,e,i){var n=t.createShader(e);t.shaderSource(n,i),t.compileShader(n);var r=t.COMPILE_STATUS;if(!t.getShaderParameter(n,r)){var o=t.getShaderInfoLog(n);throw t.deleteShader(n),new m("Unable to initialize the shader program: "+o)}return n},t}(),H=function(){function t(t,e){this.gl=e.getContext(t)}return t.prototype.createFromImage=function(t,e,i){var n=this;return void 0===e&&(e=!0),void 0===i&&(i=null),i=null!=i?i:this.gl.createTexture(),t.naturalWidth?this.create(t,i,e):t.addEventListener("load",(function(){return n.create(t,i,e)})),i},t.prototype.createFromCanvas=function(t,e,i){return void 0===e&&(e=!0),void 0===i&&(i=null),i=null!=i?i:this.gl.createTexture(),this.create(t,i,e),i},t.prototype.create=function(t,e,i){void 0===i&&(i=!0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),!1===i?(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST)):(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR)),this.gl.bindTexture(this.gl.TEXTURE_2D,null)},t}();!function(t){t.LegacyWebGL="webgl",t.WebGL2="webgl2"}(F||(F={}));var z,k,N=function(){function t(t,e,i,n,r,o,a,s,h){this.fontAtlas=new Map,this.canvas=e,this.gl=this.canvas.getContext(t),i.loadProgram(),this.textureManager=n,this.imageRenderer=o,this.tilemapRenderer=a,this.textRenderer=s,this.geometricRenderer=h,this.fontAtlasFactory=r}return t.prototype.clearCanvas=function(t){var e=V(t);this.gl.clearColor(e.r,e.g,e.b,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT)},t.prototype.render=function(t,e){e.type===u.Image&&(this.renderImage(t,e),this.lastRender="image"),e.type===u.Tilemap&&(this.renderTilemap(t,e),this.lastRender="tilemap"),e.type===u.Text&&(this.renderText(t,e),this.lastRender="text"),e.type===u.Collider&&(this.geometricRenderer.renderCollider(t.viewportRect,e,this.lastRender),this.lastRender="geometric"),e.type===u.Geometric&&(this.geometricRenderer.renderGeometric(t.viewportRect,e,this.lastRender),this.lastRender="geometric")},t.prototype.renderImage=function(t,e){this.imageRenderer.render(!0===e.ui?t.originalViewportRect:t.viewportRect,this.textureManager.getOrCreateTextureFromImage(e.image,e.smooth),e,this.lastRender)},t.prototype.renderTilemap=function(t,e){this.tilemapRenderer.render(!0===e.ui?t.originalViewportRect:t.viewportRect,this.textureManager.getOrCreateTextureFromImage(e.image,e.smooth),e,this.lastRender)},t.prototype.renderText=function(t,e){var i=this,n=Symbol.for(e.fontFamily);!1===this.fontAtlas.has(n)?this.fontAtlasFactory.create(e.charRanges,e.fontFamily,e.fontUrl,e.bitmapSize).then((function(r){i.fontAtlas.set(n,r),i.fontAtlasLoaded(r,t,e)})):this.fontAtlasLoaded(this.fontAtlas.get(n),t,e)},t.prototype.fontAtlasLoaded=function(t,e,i){this.textRenderer.render(!0===i.ui?e.originalViewportRect:e.viewportRect,this.textureManager.getOrCreateTextureFromCanvas(i.fontFamily,t.canvas,i.smooth),t,i,this.lastRender)},t}(),W=function(){function t(t,e){this.game=null,this.scenes=new Map,this.currentScene=null,this.openingSceneName=null,this.game=t,this.renderManager=e}return t.prototype.getCurrentScene=function(){return this.currentScene},t.prototype.addScene=function(t,e,i){if(void 0===i&&(i=!1),this.scenes.has(t))throw new m("There is already a scene with the name '"+t+"'");this.scenes.set(t,e),!0!==i&&null!==this.openingSceneName||(this.openingSceneName=t)},t.prototype.loadOpeningScene=function(){if(null===this.openingSceneName)throw new m("There is no opening scene");this.loadScene(this.openingSceneName)},t.prototype.loadScene=function(t){if(null===this.game)throw new m("Game not initialized.");if(!1===this.scenes.has(t))throw new m("Scene with name "+t+" does not exists");this.unloadCurrentScene(),this.currentScene=this.scenes.get(t)(),this.currentScene.name=t,this.currentScene.game=this.game},t.prototype.unloadCurrentScene=function(){null!==this.currentScene&&(this.currentScene.destroy(),this.currentScene=null,this.currentSceneName=null,this.renderManager.clearData())},t}(),q=function(){function t(t,e){if(this.maxGameDeltatime=0,this.maxPhysicsDeltaTime=0,this.timeScale=1,this.browserDeltaTime=0,this.unscaledGameDeltaTime=0,this.unscaledPhysicsDeltaTime=0,this.max=1/15,this.then=0,t<15)throw new m("Game framerate cannot be less than 15");if(e<60)throw new m("Physics framerate cannot be less than 60");if(e<t)throw new m("Physics framerate cannot be less than game framerate");this.maxGameDeltatime=parseFloat((1/t).toFixed(6)),this.maxPhysicsDeltaTime=parseFloat((1/e).toFixed(6))}return t.prototype.update=function(t){var e=.001*t;this.browserDeltaTime=Math.min(Math.max(0,e-this.then),this.max),this.then=e},Object.defineProperty(t.prototype,"deltaTime",{get:function(){return this.unscaledGameDeltaTime*this.timeScale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"physicsDeltaTime",{get:function(){return this.unscaledPhysicsDeltaTime*this.timeScale},enumerable:!1,configurable:!0}),t}(),Q=function(){function t(t){this.textures=new Map,this.textureFactory=t}return t.prototype.getTexture=function(t){var e;return null!==(e=this.textures.get(Symbol.for(t)))&&void 0!==e?e:null},t.prototype.getOrCreateTextureFromImage=function(t,e){var i;return void 0===e&&(e=!0),null!==(i=this.textures.get(Symbol.for(t.src)))&&void 0!==i?i:this.createTextureFromImage(t,e)},t.prototype.createTextureFromImage=function(t,e){void 0===e&&(e=!0);var i=this.textureFactory.createFromImage(t,e);return this.textures.set(Symbol.for(t.src),i),i},t.prototype.getOrCreateTextureFromCanvas=function(t,e,i){var n;return void 0===i&&(i=!0),null!==(n=this.textures.get(Symbol.for(t)))&&void 0!==n?n:this.createTextureFromCanvas(t,e,i)},t.prototype.createTextureFromCanvas=function(t,e,i){void 0===i&&(i=!0);var n=this.textureFactory.createFromCanvas(e,i);return this.textures.set(Symbol.for(t),n),n},t}(),Y=function(){function t(t,e,i){this.gl=i.getContext(e),this.programFactory=t,this.contextVersion=e}return t.prototype.loadProgram=function(){this.program=this.contextVersion===F.WebGL2?this.programFactory.create(this.gl,"#version 300 es\nprecision mediump float;\n\nin vec2 positionCoords;\nin vec2 textureCoords;\n\nout vec2 texCoords;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 textureMatrix;\n\nvoid main()\n{\n    gl_Position = projectionMatrix * modelMatrix * vec4(positionCoords, 0, 1);\n    texCoords = (textureMatrix * vec4(textureCoords, 0, 1)).xy;\n}","#version 300 es\nprecision mediump float;\n\nout vec4 fragColor;\n\nin vec2 texCoords;\n\nuniform int u_renderTexture;\nuniform sampler2D u_texImage;\nuniform float u_alpha;\nuniform vec4 u_color;\nuniform float u_colorMix;\n\nvoid main()\n{\n    if (u_renderTexture == 1) {\n        vec4 texColor = texture(u_texImage, texCoords);\n    \n        if(texColor.a < 0.0001)\n            discard;\n        \n        fragColor = mix(vec4(texColor.rgb, u_alpha), u_color, clamp(u_colorMix, 0.0, 1.0));\n    } else {\n        fragColor = u_color;\n    }\n}"):this.programFactory.create(this.gl,"precision mediump float;\n\nattribute vec2 positionCoords;\nattribute vec2 textureCoords;\n\nvarying vec2 texCoords;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 textureMatrix;\n\nvoid main()\n{\n    gl_Position = projectionMatrix * modelMatrix * vec4(positionCoords, 0, 1);\n    texCoords = (textureMatrix * vec4(textureCoords, 0, 1)).xy;\n}","precision mediump float;\n\nvarying vec2 texCoords;\n\nuniform int u_renderTexture;\nuniform sampler2D u_texImage;\nuniform float u_alpha;\nuniform vec4 u_color;\nuniform float u_colorMix;\n\nvoid main()\n{\n    if (u_renderTexture == 1) {\n        vec4 texColor = texture2D(u_texImage, texCoords);\n\n        if(texColor.a < 0.0001)\n            discard;\n\n        gl_FragColor = mix(vec4(texColor.rgb, u_alpha), u_color, clamp(u_colorMix, 0.0, 1.0));\n        \n    } else {\n        gl_FragColor = u_color;\n    }\n    \n}"),this.positionBuffer=this.gl.createBuffer(),this.textureBuffer=this.gl.createBuffer(),this.positionCoordsAttr=this.gl.getAttribLocation(this.program,"positionCoords"),this.texCoordsAttr=this.gl.getAttribLocation(this.program,"textureCoords"),this.modelMatrixUniform=this.gl.getUniformLocation(this.program,"modelMatrix"),this.projectionMatrixUniform=this.gl.getUniformLocation(this.program,"projectionMatrix"),this.textureMatrixUniform=this.gl.getUniformLocation(this.program,"textureMatrix"),this.textureUniform=this.gl.getUniformLocation(this.program,"u_texImage"),this.alphaUniform=this.gl.getUniformLocation(this.program,"u_alpha"),this.colorUniform=this.gl.getUniformLocation(this.program,"u_color"),this.colorMixUniform=this.gl.getUniformLocation(this.program,"u_colorMix"),this.renderTextureUniform=this.gl.getUniformLocation(this.program,"u_renderTexture"),this.gl.useProgram(this.program),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enableVertexAttribArray(this.positionCoordsAttr),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.vertexAttribPointer(this.positionCoordsAttr,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.texCoordsAttr),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureBuffer),this.gl.vertexAttribPointer(this.texCoordsAttr,2,this.gl.FLOAT,!1,0,0)},t}(),X=function(){function t(){this.bitmapSize=64}return t.prototype.create=function(t,e,i,n){return void 0===i&&(i=null),void 0===n&&(n=null),s(this,void 0,void 0,(function(){var r,o,a;return h(this,(function(s){switch(s.label){case 0:for(this.bitmapSize=null!=n?n:this.bitmapSize,r=new K(e),this.chars=[],o=0;o<t.length;o+=2)for(a=t[o];a<=t[o+1];a++)this.chars.push(String.fromCharCode(a));return r.canvas.width=Math.round(Math.sqrt(this.chars.length))*this.bitmapSize,r.canvas.height=r.canvas.width,null===i?[3,2]:[4,this.loadFont(r,e,i)];case 1:return s.sent(),[3,3];case 2:this.renderAtlas(r,e),s.label=3;case 3:return[2,r]}}))}))},t.prototype.loadFont=function(t,e,i){return s(this,void 0,void 0,(function(){var n,r;return h(this,(function(o){switch(o.label){case 0:return[4,(n=new FontFace(e,"url("+i+")")).load()];case 1:return r=o.sent(),document.fonts.add(n),this.renderAtlas(t,r.family),[2]}}))}))},t.prototype.renderAtlas=function(t,e){var i=t.canvas.getContext("2d");i.clearRect(0,0,t.canvas.width,t.canvas.height),i.textBaseline="top",i.fillStyle="#000",i.font=this.bitmapSize+"px "+e;for(var n=0,r=0,o=0;o<this.chars.length;o++)i.fillText(this.chars[o],n,r),t.glyphsData.set(this.chars[o],{x:n,y:r,width:this.bitmapSize,height:this.bitmapSize}),(n+=this.bitmapSize)>t.canvas.width-this.bitmapSize&&(n=0,r+=this.bitmapSize)},t}(),K=function(t){this.canvas=document.createElement("canvas"),this.glyphsData=new Map,this.name=t},Z=function(){function e(e,i,n){this.posVertices=[],this.texVertices=[],this.posVerticesSize=new t,this.lastTexture=null,this.maskColor=null,this.gl=i.getContext(e),this.programManager=n,this.projectionMatrix=T(),this.modelMatrix=T(),this.textureMatrix=T()}return e.prototype.render=function(t,e,i,n,r){this.generateTextVertices(i,n),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.posVertices),this.gl.DYNAMIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.textureBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.texVertices),this.gl.DYNAMIC_DRAW),this.modelMatrix=A(this.modelMatrix),E(this.modelMatrix,this.modelMatrix,[n.positionInViewport.x+("center"===n.pivot?-this.posVerticesSize.x/2:"right"===n.pivot?-this.posVerticesSize.x:0),n.positionInViewport.y+this.posVerticesSize.y/2,0]),this.textureMatrix=A(this.textureMatrix),D(this.textureMatrix,this.textureMatrix,[1/i.canvas.width,1/i.canvas.height,1]),this.projectionMatrix=A(this.projectionMatrix),G(this.projectionMatrix,t.x,t.x1,t.y,t.y1,-1,1),this.gl.uniformMatrix4fv(this.programManager.projectionMatrixUniform,!1,this.projectionMatrix),this.gl.uniformMatrix4fv(this.programManager.modelMatrixUniform,!1,this.modelMatrix),this.gl.uniformMatrix4fv(this.programManager.textureMatrixUniform,!1,this.textureMatrix),this.gl.disable(this.gl.BLEND),this.lastTexture===e&&"text"===r||(this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(this.programManager.textureUniform,0),this.lastTexture=e),this.gl.uniform1i(this.programManager.renderTextureUniform,1),this.gl.uniform1f(this.programManager.alphaUniform,1),this.maskColor=V(n.color),this.gl.uniform4f(this.programManager.colorUniform,this.maskColor.r,this.maskColor.g,this.maskColor.b,1),this.gl.uniform1f(this.programManager.colorMixUniform,1),this.gl.drawArrays(this.gl.TRIANGLES,0,this.posVertices.length/2)},e.prototype.generateTextVertices=function(t,e){this.posVertices=[],this.texVertices=[];for(var i={x1:0,y1:-e.fontSize,x2:0,y2:0},n={x1:0,y1:0,x2:0,y2:0},r=0,o=1,a=0;a<e.text.length;a++){var s=e.text[a];if("\n"!==s)if(" "!==s){var h=t.glyphsData.get(s);h&&(i.x2=i.x1+e.fontSize,r=Math.max(i.x2,r),n.x1=h.x+e.bitmapOffset.x,n.y1=h.y+e.bitmapOffset.y,n.x2=h.x+h.width-1,n.y2=h.y+h.height-1,this.posVertices.push(i.x1,i.y1,i.x2,i.y1,i.x1,i.y2,i.x1,i.y2,i.x2,i.y1,i.x2,i.y2),this.texVertices.push(n.x1,n.y2,n.x2,n.y2,n.x1,n.y1,n.x1,n.y1,n.x2,n.y2,n.x2,n.y1)),i.x1+=e.fontSize+e.letterSpacing}else i.x1+=e.fontSize+e.letterSpacing;else i.y1-=e.fontSize+e.lineSeparation,i.y2=i.y1+e.fontSize,i.x1=0,o++}this.posVerticesSize.set(r,o*e.fontSize+(o-1)*e.lineSeparation)},e}(),$=function(){function t(t,e,i){this.vertices=new Map,this.texVertices=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.lastVertices=null,this.lastRender=null,this.gl=e.getContext(t),this.programManager=i,this.projectionMatrix=T(),this.modelMatrix=T(),this.textureMatrix=T()}return t.prototype.renderCollider=function(t,e,i){this.lastRender=i,e.shape.type===d.Rectangle&&this.renderRectangle(t,e.positionInViewport,{width:e.shape.width,height:e.shape.height},e.color,e.shape.angle)},t.prototype.renderGeometric=function(t,e,i){this.lastRender=i,"Rectangle"===e.geometricType&&this.renderRectangle(t,e.positionInViewport,{width:e.getGeometric().width,height:e.getGeometric().height},e.color)},t.prototype.renderRectangle=function(t,e,i,n,r){void 0===r&&(r=0);var o=Symbol.for("RW"+i.width+"H"+i.height);!1===this.vertices.has(o)&&this.vertices.set(o,new Float32Array(this.generateRectangleVertices(i.width,i.height,1)));var a=this.vertices.get(o);this.lastVertices===o&&"geometric"===this.lastRender||(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,a,this.gl.DYNAMIC_DRAW)),this.lastVertices=o,"geometric"!==this.lastRender&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.textureBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.texVertices,this.gl.DYNAMIC_DRAW)),this.modelMatrix=A(this.modelMatrix),E(this.modelMatrix,this.modelMatrix,[e.x,e.y,0]),B(this.modelMatrix,this.modelMatrix,r),this.projectionMatrix=A(this.projectionMatrix),G(this.projectionMatrix,t.x,t.x1,t.y,t.y1,-1,1),this.gl.uniformMatrix4fv(this.programManager.projectionMatrixUniform,!1,this.projectionMatrix),this.gl.uniformMatrix4fv(this.programManager.modelMatrixUniform,!1,this.modelMatrix),this.gl.uniformMatrix4fv(this.programManager.textureMatrixUniform,!1,this.textureMatrix),this.gl.uniform1i(this.programManager.renderTextureUniform,0),this.rgbColor=V(n),this.gl.uniform4f(this.programManager.colorUniform,this.rgbColor.r,this.rgbColor.g,this.rgbColor.b,1),this.gl.drawArrays(this.gl.TRIANGLES,0,a.length/2)},t.prototype.generateRectangleVertices=function(t,e,i){var n=e/2,r=t/2;return c(this.generateLineVertices(-r,-n,r,-n+i),this.generateLineVertices(r-i,-n,r,n),this.generateLineVertices(-r,n-i,r,n),this.generateLineVertices(-r,-n,-r+i,n))},t.prototype.generateLineVertices=function(t,e,i,n){return[t,e,i,e,t,n,t,n,i,e,i,n]},t}(),J=function(){function e(e,i){this._displacementDirection=new t,this._penetration=e,this._displacementDirection.set(i.x,i.y)}return Object.defineProperty(e.prototype,"penetration",{get:function(){return this._penetration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"displacementDirection",{get:function(){return this._displacementDirection},enumerable:!1,configurable:!0}),e}(),tt=function(){function e(){this.proj1={min:0,max:0},this.proj2={min:0,max:0}}return e.prototype.getCollisionData=function(e,i){this.currentOverlap=null,this.minOverlap=null,this.displaceDirection=null,this.axes=c(e.getAxes(),i.getAxes());for(var n=0;n<this.axes.length;n++){if(this.projectShapeOntoAxis(this.proj1,this.axes[n],e),this.projectShapeOntoAxis(this.proj2,this.axes[n],i),this.currentOverlap=Math.min(this.proj1.max,this.proj2.max)-Math.max(this.proj1.min,this.proj2.min),this.currentOverlap<0)return null;this.preventContainment(n),(this.currentOverlap<this.minOverlap||null===this.minOverlap)&&(this.minOverlap=this.currentOverlap,this.displaceDirection=this.axes[n],this.proj1.max<this.proj2.max&&t.scale(this.displaceDirection,this.displaceDirection,-1))}return new J(this.minOverlap,this.displaceDirection)},e.prototype.projectShapeOntoAxis=function(e,i,n){return e.min=t.dot(i,n.vertices[0]),e.max=e.min,n.vertices.forEach((function(n){e.min=Math.min(t.dot(i,n),e.min),e.max=Math.max(t.dot(i,n),e.max)})),e},e.prototype.preventContainment=function(e){if(this.proj1.max>this.proj2.max&&this.proj1.min<this.proj2.min||this.proj1.max<this.proj2.max&&this.proj1.min>this.proj2.min){var i=Math.abs(this.proj1.min-this.proj2.min),n=Math.abs(this.proj1.max-this.proj2.max);i<n?this.currentOverlap+=i:(this.currentOverlap+=n,t.scale(this.axes[e],this.axes[e],-1))}},e}(),et=function(){function e(e){var i=this;this._touching=!1,this._positionInViewport=new t(0,0),this._radius=new t(0,0),this.eventHandler=function(t){"touchstart"===t.type&&(i._touching=!0,i.updatePosition(t)),"touchmove"===t.type&&i.updatePosition(t),"touchend"!==t.type&&"touchcancel"!==t.type||(i._touching=!1)},this.canvas=e,this.canvas.addEventListener("touchstart",this.eventHandler),this.canvas.addEventListener("touchend",this.eventHandler),this.canvas.addEventListener("touchcancel",this.eventHandler),this.canvas.addEventListener("touchmove",this.eventHandler)}return Object.defineProperty(e.prototype,"positionInViewport",{get:function(){return this._positionInViewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"touching",{get:function(){return this._touching},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},enumerable:!1,configurable:!0}),e.prototype.updatePosition=function(t){t.preventDefault(),t.stopPropagation(),0!==t.targetTouches.length&&(this._positionInViewport.set((t.targetTouches[0].clientX-this.canvas.offsetLeft)/(this.canvas.clientWidth/this.canvas.width)-this.canvas.width/2,-(t.targetTouches[0].clientY-this.canvas.offsetTop)/(this.canvas.clientHeight/this.canvas.height)+this.canvas.height/2),this._radius.set(t.targetTouches[0].radiusX,t.targetTouches[0].radiusY))},e}(),it=function(){function i(){this.shape1Rect=new e(0,0,0,0),this.shape2Rect=new e(0,0,0,0),this.displaceDirection=new t}return i.prototype.getCollisionData=function(t,e){return this.setShapeRect(t,this.shape1Rect),this.setShapeRect(e,this.shape2Rect),this.overlapX=Math.min(this.shape1Rect.x1,this.shape2Rect.x1)-Math.max(this.shape1Rect.x,this.shape2Rect.x),this.overlapY=Math.min(this.shape1Rect.y1,this.shape2Rect.y1)-Math.max(this.shape1Rect.y,this.shape2Rect.y),this.overlapX<0||this.overlapY<0?null:(this.overlapY<this.overlapX?(this.minOverlap=this.overlapY,this.displaceDirection.set(0,Math.sign(this.shape1Rect.y1-this.shape2Rect.y1)),this.preventContainment(this.shape1Rect.y,this.shape2Rect.y,this.shape1Rect.y1,this.shape2Rect.y1)):(this.minOverlap=this.overlapX,this.displaceDirection.set(Math.sign(this.shape1Rect.x1-this.shape2Rect.x1),this.overlapY===this.overlapX?Math.sign(this.shape1Rect.y1-this.shape2Rect.y1):0),this.preventContainment(this.shape1Rect.x,this.shape2Rect.x,this.shape1Rect.x1,this.shape2Rect.x1)),new J(this.minOverlap,this.displaceDirection))},i.prototype.setShapeRect=function(t,e){e.set(t.position.x-t.width/2,t.position.y-t.height/2,t.width,t.height)},i.prototype.preventContainment=function(e,i,n,r){if(e>n&&i<r||n>e&&r<i){var o=Math.abs(e-n),a=Math.abs(i-r);o<a?this.minOverlap+=o:(this.minOverlap+=a,t.scale(this.displaceDirection,this.displaceDirection,-1))}},i}(),nt=function(){function t(){}return t.prototype.applyCulling=function(t,e){var i=this;return e.filter((function(e){if(!1===t.layers.includes(e.layer))return!1;switch(e.type){case u.Image:return i.cullSprite(t,e);case u.Tilemap:return i.cullTilemap(t,e);case u.Collider:return i.cullCollider(t,e);case u.Geometric:return i.cullGeometric(t,e);case u.Text:return!0}}))},t.prototype.cullSprite=function(t,e){return this.isTargetVisible(t.worldSpaceRect,{x:e.position.x-e.width/2,x1:e.position.x+e.width/2,y:e.position.y-e.height/2,y1:e.position.y+e.height/2})},t.prototype.cullTilemap=function(t,e){var i=this;return e.tilesToRender=e.tilesData.filter((function(n){return i.isTargetVisible(t.worldSpaceRect,{x:n.position.x-e.tileWidth/2,x1:n.position.x+e.tileWidth/2,y:n.position.y-e.tileHeight/2,y1:n.position.y+e.tileHeight/2})})),e.tilesData.length>0},t.prototype.cullCollider=function(t,e){return this.isTargetVisible(t.worldSpaceRect,{x:e.position.x-e.shape.width/2,x1:e.position.x+e.shape.width/2,y:e.position.y-e.shape.height/2,y1:e.position.y+e.shape.height/2})},t.prototype.cullGeometric=function(t,e){return this.isTargetVisible(t.worldSpaceRect,{x:e.position.x-e.geometric.width/2,x1:e.position.x+e.geometric.width/2,y:e.position.y-e.geometric.height/2,y1:e.position.y+e.geometric.height/2})},t.prototype.isTargetVisible=function(t,e){return t.x1>=e.x&&t.x<=e.x1&&t.y1>=e.y&&t.y<=e.y1},t}(),rt=function(){function t(t,e,i){this.posVertices=[],this.texVertices=[],this.lastTexture=null,this.maskColor=null,this.p={x1:0,y1:0,x2:0,y2:0},this.t={x1:0,y1:0,x2:0,y2:0},this.gl=e.getContext(t),this.programManager=i,this.projectionMatrix=T(),this.modelMatrix=T(),this.textureMatrix=T()}return t.prototype.render=function(t,e,i,n){this.generateVertices(i),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.posVertices),this.gl.DYNAMIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.textureBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.texVertices),this.gl.DYNAMIC_DRAW),this.modelMatrix=A(this.modelMatrix),this.textureMatrix=A(this.textureMatrix),D(this.textureMatrix,this.textureMatrix,[1/i.image.naturalWidth,1/i.image.naturalHeight,1]),this.projectionMatrix=A(this.projectionMatrix),G(this.projectionMatrix,t.x,t.x1,t.y,t.y1,-1,1),this.gl.uniformMatrix4fv(this.programManager.projectionMatrixUniform,!1,this.projectionMatrix),this.gl.uniformMatrix4fv(this.programManager.modelMatrixUniform,!1,this.modelMatrix),this.gl.uniformMatrix4fv(this.programManager.textureMatrixUniform,!1,this.textureMatrix),i.alpha<1?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this.lastTexture===e&&"tilemap"===n||(this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(this.programManager.textureUniform,0),this.lastTexture=e),this.gl.uniform1i(this.programManager.renderTextureUniform,1),this.gl.uniform1f(this.programManager.alphaUniform,i.alpha),this.maskColor={r:1,g:1,b:1},this.gl.uniform4f(this.programManager.colorUniform,this.maskColor.r,this.maskColor.g,this.maskColor.b,1),this.gl.uniform1f(this.programManager.colorMixUniform,0),this.gl.drawArrays(this.gl.TRIANGLES,0,this.posVertices.length/2)},t.prototype.generateVertices=function(t){var e=this;this.posVertices=[],this.texVertices=[],t.tilesToRender.forEach((function(i){var n,r;e.p.x1=i.positionInViewport.x-t.tileWidth/2,e.p.x2=i.positionInViewport.x+t.tileWidth/2,e.p.y1=i.positionInViewport.y-t.tileHeight/2,e.p.y2=i.positionInViewport.y+t.tileHeight/2,e.posVertices.push(e.p.x1,e.p.y1,e.p.x2,e.p.y1,e.p.x1,e.p.y2,e.p.x1,e.p.y2,e.p.x2,e.p.y1,e.p.x2,e.p.y2),e.t.x1=i.tile.x,e.t.y1=i.tile.y,e.t.x2=i.tile.x+i.tile.width-(null!==(n=t.textureCorrection)&&void 0!==n?n:0),e.t.y2=i.tile.y+i.tile.height-(null!==(r=t.textureCorrection)&&void 0!==r?r:0),e.texVertices.push(e.t.x1,e.t.y2,e.t.x2,e.t.y2,e.t.x1,e.t.y1,e.t.x1,e.t.y1,e.t.x2,e.t.y2,e.t.x2,e.t.y1)}))},t}(),ot=function(){function t(t,e,i){this.gameLoopAccumulator=0,this.physicsLoopAccumulator=0,this.deltaAux=0,this.timeManager=t,this.collisionManager=e,this.renderManager=i}return t.prototype.update=function(t){for(this.timeManager.update(t),this.deltaAux=Math.min(this.timeManager.browserDeltaTime,this.timeManager.maxGameDeltatime),this.gameLoopAccumulator+=this.deltaAux,this.physicsLoopAccumulator+=this.timeManager.browserDeltaTime,this.timeManager.unscaledGameDeltaTime=Math.max(this.timeManager.maxGameDeltatime,this.timeManager.browserDeltaTime),this.timeManager.unscaledPhysicsDeltaTime=this.timeManager.maxPhysicsDeltaTime,this.gameLoopAccumulator>this.timeManager.maxGameDeltatime&&(this.mainIteration(),this.gameLoopAccumulator-=this.timeManager.maxGameDeltatime);this.physicsLoopAccumulator>this.timeManager.maxPhysicsDeltaTime;)this.timeManager.timeScale>0&&this.physicsIteration(),this.physicsLoopAccumulator-=this.timeManager.maxPhysicsDeltaTime;this.preRenderIteration(),this.renderIteration()},t.prototype.mainIteration=function(){this.dispatchFrameEvent(dt),this.dispatchFrameEvent(ft),this.dispatchFrameEvent(gt),this.dispatchFrameEvent(bt),this.dispatchFrameEvent(mt),this.collisionManager.update()},t.prototype.physicsIteration=function(){this.dispatchFrameEvent(yt),this.dispatchFrameEvent(mt)},t.prototype.preRenderIteration=function(){this.dispatchFrameEvent(bt),this.dispatchFrameEvent(vt),this.dispatchFrameEvent(xt)},t.prototype.renderIteration=function(){this.dispatchFrameEvent(wt),this.renderManager.clearCanvas(),this.renderManager.render()},t.prototype.dispatchFrameEvent=function(t){window.dispatchEvent(new CustomEvent(t))},t}(),at=function(){function t(){this.instances=new Map,this.constructors=new Map,this.constants=new Map}return t.prototype.add=function(t,e){if(this.constructors.has(t))throw new m("There is already an object constructor with the name "+t);this.constructors.set(t,e)},t.prototype.getSingleton=function(t){if(!1===this.constructors.has(t))throw new m("Invalid object constructor name: "+t);return!1===this.instances.has(t)&&this.instances.set(t,this.constructors.get(t)()),this.instances.get(t)},t.prototype.getTranscient=function(t){if(!1===this.constructors.has(t))throw new m("Invalid object constructor name: "+t);return this.constructors.get(t)()},t.prototype.addConstant=function(t,e){if(this.constants.has(t))throw new m("There is already a constant value with the name "+t);this.constants.set(t,e)},t.prototype.getConstant=function(t){if(!1===this.constants.has(t))throw new m("Invalid constant name: "+t);return this.constants.get(t)},t}(),st=function(){function t(){}return t.initialize=function(){this.assetManager=_t.getSingleton("AssetManager")},t.getAssetsLoaded=function(){return this.assetManager.getAssetsLoaded()},t.createImage=function(t){return this.assetManager.createImage(t)},t.createAudio=function(t){return this.assetManager.createAudio(t)},t.getImage=function(t){return this.assetManager.getImage(t)},t.getAudio=function(t){return this.assetManager.getAudio(t)},t.assetManager=null,t}(),ht=function(){function t(){}return t.initialize=function(){this.domManager=_t.getSingleton("DomManager")},Object.defineProperty(t,"gameWidth",{get:function(){return this.domManager.canvas.width},enumerable:!1,configurable:!0}),Object.defineProperty(t,"gameHeight",{get:function(){return this.domManager.canvas.height},enumerable:!1,configurable:!0}),Object.defineProperty(t,"canvas",{get:function(){return this.domManager.canvas},enumerable:!1,configurable:!0}),t.domManager=null,t}(),ct=function(){function t(){}return t.initialize=function(){this.inputManager=_t.getSingleton("InputManager")},Object.defineProperty(t,"mouse",{get:function(){return this.inputManager.mouse},enumerable:!1,configurable:!0}),Object.defineProperty(t,"keyboard",{get:function(){return this.inputManager.keyboard},enumerable:!1,configurable:!0}),Object.defineProperty(t,"gamepad",{get:function(){return this.inputManager.gamepad},enumerable:!1,configurable:!0}),Object.defineProperty(t,"touch",{get:function(){return this.inputManager.touch},enumerable:!1,configurable:!0}),t.inputManager=null,t}(),ut=function(){function t(){}return t.initialize=function(){this.sceneManager=_t.getSingleton("SceneManager")},t.loadScene=function(t){this.sceneManager.loadScene(t)},t.getCurrentSceneName=function(){return this.sceneManager.currentSceneName},t.loadOpeningScene=function(){this.sceneManager.loadOpeningScene()},t.sceneManager=null,t}(),lt=function(){function t(){}return t.initialize=function(){this.timeManager=_t.getSingleton("TimeManager")},Object.defineProperty(t,"deltaTime",{get:function(){return this.timeManager.deltaTime},enumerable:!1,configurable:!0}),t.getTimeScale=function(){return this.timeManager.timeScale},t.setTimeScale=function(t){this.timeManager.timeScale=t},Object.defineProperty(t,"unscaledDeltaTime",{get:function(){return this.timeManager.unscaledGameDeltaTime},enumerable:!1,configurable:!0}),Object.defineProperty(t,"physicsDeltaTime",{get:function(){return this.timeManager.physicsDeltaTime},enumerable:!1,configurable:!0}),t.timeManager=null,t}(),pt=function(){function t(){}return t.initialize=function(){this.manager=_t.getSingleton("GameObjectManager")},t.addGameObject=function(t,e,i){return void 0===i&&(i=null),this.manager.addGameObject(t,e,i)},t.getGameObjects=function(){return this.manager.getGameObjects()},t.findGameObjectByName=function(t){return this.manager.findGameObjectByName(t)},t.findGameObjectsByParent=function(t){return this.manager.findGameObjectsByParent(t)},t.findGameObjectByParentAndName=function(t,e){return this.manager.findGameObjectByParentAndName(t,e)},t.findGameObjectsByTag=function(t){return this.manager.findGameObjectsByTag(t)},t.findGameObjectByTag=function(t){return this.manager.findGameObjectByTag(t)},t.destroyAllGameObjects=function(){this.manager.destroyAllGameObjects()},t.destroyGameObject=function(t){this.manager.destroyGameObject(t)},t.destroyGameObjectByName=function(t){this.destroyGameObject(this.findGameObjectByName(t))},t}(),dt="mini-engine-start",ft="mini-engine-update",gt="mini-engine-update-engine",mt="mini-engine-update-collider",yt="mini-engine-update-physics",bt="mini-engine-update-transform",vt="mini-engine-update-prerender",xt="mini-engine-update-camera",wt="mini-engine-update-render",_t=new at;!function(t){t.Default="default",t.Disabled="disabled",t.Fallback="fallback"}(z||(z={})),function(t){t.AABB="aabb",t.SAT="sat"}(k||(k={}));var Ot,jt={containerNode:null,gameWidth:320,gameHeight:180,debugEnabled:!1,canvasColor:"#000000",context2d:z.Fallback,spriteDefaultScale:null,gameFrameRate:60,physicsFramerate:240,collisions:{method:k.AABB,quadTreeBounds:null,debugQuadTree:!1,quadMaxLevel:6,collidersPerQuad:15}},Mt=function(){function t(t){var e=this;this._running=!1,this._stop=!1,this.frameRequestId=null,this.errorEventHandler=function(t){-1!==t.error.message.indexOf(m.messagePrefix)&&(e.stop(),t.stopPropagation(),t.preventDefault(),console.error(t.error.message+"\n"+t.filename+":"+t.lineno))},this._config=a(a({},jt),t),this._config.collisions=a(a({},jt.collisions),t.collisions),window.addEventListener("error",this.errorEventHandler),this.setupManagers(),this.initializeFacades()}return t.prototype.setupManagers=function(){!function(t,e){t.addConstant("GameConfig",e.config),t.add("DomManager",(function(){return new v(e.config.containerNode,e.config.gameWidth,e.config.gameHeight)}));var i=t.getSingleton("DomManager");(function(t,e,i){var n=null!==document.createElement("canvas").getContext(F.WebGL2)?F.WebGL2:null!==document.createElement("canvas").getContext(F.LegacyWebGL)?F.LegacyWebGL:null;if(e.config.context2d===z.Default||e.config.context2d===z.Fallback&&null===n)t.add("Renderer",(function(){return new C(i.canvas)})),e.config.debugEnabled&&console.log("Using 2d rendering context");else{if(null===n)throw new m("WebGL is not supported, use context2d instead.");(function(t,e,i){e.add("ShaderLoader",(function(){return new U})),e.add("ProgramFactory",(function(){return new L(e.getSingleton("ShaderLoader"))})),e.add("ProgramManager",(function(){return new Y(e.getSingleton("ProgramFactory"),t,i.canvas)})),e.add("TextureFactory",(function(){return new H(t,i.canvas)})),e.add("TextureManager",(function(){return new Q(e.getSingleton("TextureFactory"))})),e.add("WebGLImageRenderer",(function(){return new I(t,i.canvas,e.getSingleton("ProgramManager"))})),e.add("WebGLTextRenderer",(function(){return new Z(t,i.canvas,e.getSingleton("ProgramManager"))})),e.add("WebGLGeometricRenderer",(function(){return new $(t,i.canvas,e.getSingleton("ProgramManager"))})),e.add("WebGLTilemapRenderer",(function(){return new rt(t,i.canvas,e.getSingleton("ProgramManager"))})),e.add("Renderer",(function(){return new N(t,i.canvas,e.getSingleton("ProgramManager"),e.getSingleton("TextureManager"),e.getSingleton("FontAtlasFactory"),e.getSingleton("WebGLImageRenderer"),e.getSingleton("WebGLTilemapRenderer"),e.getSingleton("WebGLTextRenderer"),e.getSingleton("WebGLGeometricRenderer"))}))})(n,t,i),e.config.debugEnabled&&console.log("Using WebGL rendering context (version: "+n+")")}t.add("FontAtlasFactory",(function(){return new X})),t.add("CullingService",(function(){return new nt})),t.add("RenderManager",(function(){return new R(t.getSingleton("Renderer"),t.getSingleton("CullingService"),e.config.canvasColor,e.config.debugEnabled)}))})(t,e,i),function(t,e){t.add("Mouse",(function(){return new M(e.canvas)})),t.add("Keyboard",(function(){return new j(e.canvas)})),t.add("Gamepad",(function(){return new w})),t.add("Touch",(function(){return new et(e.canvas)})),t.add("InputManager",(function(){return new O(t.getSingleton("Mouse"),t.getSingleton("Keyboard"),t.getSingleton("Gamepad"),t.getSingleton("Touch"))}))}(t,i),function(t,e){if(e.config.collisions.method===k.AABB)t.add("CollisionResolver",(function(){return new it}));else{if(e.config.collisions.method!==k.SAT)throw new m("Invalid collision method.");t.add("CollisionResolver",(function(){return new tt}))}t.add("CollisionManager",(function(){return new b(t.getSingleton("CollisionResolver"),t.getSingleton("RenderManager"),e.config.collisions.quadTreeBounds,e.config.collisions.quadMaxLevel,e.config.collisions.collidersPerQuad,e.config.debugEnabled&&e.config.collisions.debugQuadTree)}))}(t,e),t.add("SceneManager",(function(){return new W(e,t.getSingleton("RenderManager"))})),t.add("GameObjectManager",(function(){return new x})),t.add("AssetManager",(function(){return new p})),t.add("TimeManager",(function(){return new q(e.config.gameFrameRate,e.config.physicsFramerate)})),t.add("IterationManager",(function(){return new ot(t.getSingleton("TimeManager"),t.getSingleton("CollisionManager"),t.getSingleton("RenderManager"))}))}(_t,this),this.renderManager=_t.getSingleton("RenderManager"),this.sceneManager=_t.getSingleton("SceneManager"),this.iterationManager=_t.getSingleton("IterationManager")},t.prototype.initializeFacades=function(){st.initialize(),ht.initialize(),ct.initialize(),ut.initialize(),lt.initialize(),pt.initialize()},Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"running",{get:function(){return this._running},enumerable:!1,configurable:!0}),t.prototype.addScene=function(t,e,i){void 0===i&&(i=!1),this.sceneManager.addScene(t,e,i)},t.prototype.run=function(){this.sceneManager.loadOpeningScene(),this.requestAnimationFrame()},t.prototype.stop=function(){this.pauseLoop(),this.sceneManager.unloadCurrentScene(),this.renderManager.clearCanvas()},t.prototype.gameLoop=function(t){!0!==this._stop&&(this._running=!0,this.iterationManager.update(t),this.requestAnimationFrame())},t.prototype.pauseLoop=function(){this._stop=!0,this._running=!1,null!==this.frameRequestId&&(window.cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},t.prototype.resumeLoop=function(){0==this._running&&null===this.frameRequestId&&(this._stop=!1,this.requestAnimationFrame())},t.prototype.requestAnimationFrame=function(){var t=this;this.frameRequestId=window.requestAnimationFrame((function(e){return t.gameLoop(e)}))},t}(),Pt=function(){var t=(new Date).getTime(),e=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){var n=16*Math.random();return t>0?(n=(t+n)%16|0,t=Math.floor(t/16)):(n=(e+n)%16|0,e=Math.floor(e/16)),("x"==i?n:7&n|8).toString(16)}))},Ct=function(){function t(){var t=this;this.sceneManager=_t.getSingleton("SceneManager"),this.gameObjectManager=_t.getSingleton("GameObjectManager"),this.id=Pt(),this.allowMultiple=!0,this.type=null,this.name=null,this.gameObject=null,this._active=!0,this.started=!1,this.gameLoopEventHandler=function(e){if(!1!==t._active)try{!1===t.started&&e.type===dt?(t.start(),t.started=!0):!0===t.started&&e.type===t.updateEvent&&t.update()}catch(t){throw-1!==t.message.indexOf(m.messagePrefix)?t:new m(t.message)}},window.addEventListener(dt,this.gameLoopEventHandler),window.addEventListener(this.updateEvent,this.gameLoopEventHandler)}return Object.defineProperty(t.prototype,"updateEvent",{get:function(){return ft},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"active",{get:function(){return this._active},enumerable:!1,configurable:!0}),t.prototype.setActive=function(t){this._active=t},t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.getCurrentScene=function(){return this.sceneManager.getCurrentScene()},t.prototype.addGameObject=function(t,e){return this.gameObjectManager.addGameObject(t,e)},t.prototype.getComponentByName=function(t){return this.gameObject.getComponentByName(t)},t.prototype.getComponentByType=function(t){return this.gameObject.getComponentByType(t)},t.prototype.getComponentsByType=function(t){return this.gameObject.getComponentsByType(t)},t.prototype.findGameObjectByName=function(t){return this.gameObjectManager.findGameObjectByName(t)},t.prototype.findGameObjectsByTag=function(t){return this.gameObjectManager.findGameObjectsByTag(t)},t.prototype.findGameObjectByTag=function(t){return this.gameObjectManager.findGameObjectByTag(t)},t.prototype.destroyGameObjectByName=function(t){this.destroyGameObject(this.findGameObjectByName(t))},t.prototype.destroyGameObject=function(t){this.gameObjectManager.destroyGameObject(t)},t.prototype.hasComponentOfName=function(t){return null!==this.getComponentByName(t)},t.prototype.hasComponentOfType=function(t){return null!==this.getComponentByType(t)},t.prototype.removeComponentByName=function(t){this.gameObject.removeComponentByName(t)},t.prototype.removeComponentByType=function(t){this.gameObject.removeComponentByType(t)},t.prototype.destroy=function(){var t=this;window.removeEventListener(dt,this.gameLoopEventHandler),window.removeEventListener(this.updateEvent,this.gameLoopEventHandler),Object.keys(this).forEach((function(e){return delete t[e]}))},t}(),Rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),Object.defineProperty(e.prototype,"updateEvent",{get:function(){return gt},enumerable:!1,configurable:!0}),e}(Ct),St=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),Object.defineProperty(e.prototype,"updateEvent",{get:function(){return mt},enumerable:!1,configurable:!0}),e}(Ct),Tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),Object.defineProperty(e.prototype,"updateEvent",{get:function(){return yt},enumerable:!1,configurable:!0}),e}(Ct),At=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),Object.defineProperty(e.prototype,"updateEvent",{get:function(){return bt},enumerable:!1,configurable:!0}),e}(Ct),Et=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}r(e,t),Object.defineProperty(e.prototype,"updateEvent",{get:function(){return vt},enumerable:!1,configurable:!0})}(Ct),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),Object.defineProperty(e.prototype,"updateEvent",{get:function(){return xt},enumerable:!1,configurable:!0}),e}(Ct)),Dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),Object.defineProperty(e.prototype,"updateEvent",{get:function(){return wt},enumerable:!1,configurable:!0}),e}(Ct),Bt=function(){function e(){this._degrees=0,this._radians=0,this._direction=new t}return Object.defineProperty(e.prototype,"degrees",{get:function(){return this._degrees},set:function(t){this._degrees=t,this._radians=t*Math.PI/180,this.updateDirection()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"radians",{get:function(){return this._radians},set:function(t){this._radians=t,this._degrees=180*t/Math.PI,this.updateDirection()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"direction",{get:function(){return this._direction},enumerable:!1,configurable:!0}),e.prototype.updateDirection=function(){this._direction.set(Math.cos(this._radians),Math.sin(this._radians))},e}(),Gt=function(e){function i(){var i=e.call(this)||this;return i._position=new t,i._scale=new t(1,1),i._rotation=new Bt,i._innerPosition=new t,i._parent=null,i.parentScale=!0,i.parentRotation=!0,i.cache=new t,i.lastParentRadians=0,i.allowMultiple=!1,i.type="Transform",i}return r(i,e),Object.defineProperty(i.prototype,"position",{get:function(){return this._position},set:function(t){this._parent&&this.updateInnerPosition(this._parent.position),this._position.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rotation},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"direction",{get:function(){return this._rotation.direction},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"innerPosition",{get:function(){return this._innerPosition},set:function(t){this._innerPosition.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},set:function(t){null===this._parent&&null!==t&&this.updateInnerPosition(t.position),this._parent=t},enumerable:!1,configurable:!0}),i.prototype.updateInnerPosition=function(e){t.subtract(this._innerPosition,this._position,e)},i.prototype.update=function(){null!==this._parent?this.setPositionFromParent():this._innerPosition.copy(this._position)},i.prototype.setPositionFromParent=function(){this._innerPosition.magnitude>0?(0!==this._parent.rotation.radians&&this.lastParentRadians!==this._parent.rotation.radians&&(this.translateInnerPosition(),this.lastParentRadians=this._parent.rotation.radians),t.add(this._position,this._parent.position,this._innerPosition)):this._position.copy(this._parent.position),this._rotation.radians=this.parentRotation?this._parent.rotation.radians:this.rotation.radians,this.parentScale&&this._scale.copy(this._parent.scale)},i.prototype.translateInnerPosition=function(){var e=Math.atan2(this._innerPosition.y,this._innerPosition.x)+(this._parent.rotation.radians-this.lastParentRadians);this.cache.set(Math.cos(e),Math.sin(e)),t.scale(this._innerPosition,this.cache,this._innerPosition.magnitude)},i}(At),Ft=function(){function t(){var t=this;this.id=Pt(),this.name=null,this.tag=null,this.layer="Default",this.ui=!1,this._active=!0,this.started=!1,this._parent=null,this.sceneManager=_t.getSingleton("SceneManager"),this.gameObjectManager=_t.getSingleton("GameObjectManager"),this.components=[],this.inactiveComponents=[],this.inactiveChildren=[],this.gameLoopEventHandler=function(e){if(!1!==t._active)try{!1===t.started&&e.type===dt?(t.start(),t.started=!0):!0===t.started&&e.type===ft&&t.update()}catch(t){throw-1!==t.message.indexOf(m.messagePrefix)?t:new m(t.message)}},this.addComponent((function(){return new Gt})),window.addEventListener(dt,this.gameLoopEventHandler),window.addEventListener(ft,this.gameLoopEventHandler)}return Object.defineProperty(t.prototype,"transform",{get:function(){return this.getComponentByType("Transform")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"active",{get:function(){return this._active},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},set:function(t){this._parent=t,this.transform.parent=t?t.transform:null},enumerable:!1,configurable:!0}),t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.getCurrentScene=function(){return this.sceneManager.getCurrentScene()},t.prototype.addGameObject=function(t,e){return this.gameObjectManager.addGameObject(t,e)},t.prototype.findGameObjectByName=function(t){return this.gameObjectManager.findGameObjectByName(t)},t.prototype.findGameObjectsByTag=function(t){return this.gameObjectManager.findGameObjectsByTag(t)},t.prototype.findGameObjectByTag=function(t){return this.gameObjectManager.findGameObjectByTag(t)},t.prototype.addComponent=function(t,e){void 0===e&&(e=null);var i=t();return this.checkMultipleComponent(i),i.name=e,i.gameObject=this,this.components.push(i),i},t.prototype.checkMultipleComponent=function(t){if(!1===t.allowMultiple&&this.hasComponentOfType(t.type))throw new m("GameObject only allows one component of type "+t.type)},t.prototype.getComponents=function(){return this.components},t.prototype.getComponentByName=function(t){return this.components.reduce((function(e,i){return i.name===t?i:e}),null)},t.prototype.getComponentByType=function(t){return this.components.reduce((function(e,i){return i.type===t?i:e}),null)},t.prototype.getComponentsByType=function(t){return this.components.filter((function(e){return e.type===t}))},t.prototype.hasComponentOfName=function(t){return null!==this.getComponentByName(t)},t.prototype.hasComponentOfType=function(t){return null!==this.getComponentByType(t)},t.prototype.removeComponentByName=function(t){var e=this;this.components.every((function(i,n){if(i.name===t)return i.destroy(),delete e.components[n],!1}))},t.prototype.removeComponentByType=function(t){var e=this;this.components.every((function(i,n){if(i.type===t)return i.destroy(),delete e.components[n],!1}))},t.prototype.removeComponents=function(){var t=this;this.components.every((function(e,i){return e.destroy(),delete t.components[i]})),this.components=[]},t.prototype.addChild=function(t,e){return this.gameObjectManager.addGameObject(t,e,this)},t.prototype.getChildren=function(){return this.gameObjectManager.findGameObjectsByParent(this)},t.prototype.getChild=function(t){return this.gameObjectManager.findGameObjectByParentAndName(this,t)},t.prototype.destroyChildren=function(){var t=this;this.gameObjectManager.findGameObjectsByParent(this).forEach((function(e){return t.gameObjectManager.destroyGameObject(e)}))},t.prototype.setActive=function(t){var e=this;!1===t&&this.updateInactiveCache(),this.components.filter((function(t){return-1===e.inactiveComponents.indexOf(t.id)})).forEach((function(e){return e.setActive(t)})),this.getChildren().filter((function(t){return-1===e.inactiveChildren.indexOf(t.id)})).forEach((function(e){return e.setActive(t)})),this._active=t},t.prototype.updateInactiveCache=function(){var t=this;this.inactiveComponents=[],this.inactiveChildren=[],this.components.filter((function(t){return!1===t.active})).forEach((function(e){return t.inactiveComponents.push(e.id)})),this.getChildren().filter((function(t){return!1===t.active})).forEach((function(e){return t.inactiveChildren.push(e.id)}))},t.prototype.destroyGameObjectByName=function(t){this.destroyGameObject(this.findGameObjectByName(t))},t.prototype.destroyGameObject=function(t){this.gameObjectManager.destroyGameObject(t)},t.prototype.destroy=function(){var t=this;window.removeEventListener(dt,this.gameLoopEventHandler),window.removeEventListener(ft,this.gameLoopEventHandler),this.removeComponents(),Object.keys(this).forEach((function(e){return delete t[e]}))},t}(),Vt=function(){this.depth=0,this.layers=[],this.originalViewportRect=null,this.viewportRect=null,this.worldSpaceRect=null,this.zoom=0},It=["Default"],Lt=function(t){function i(){var i=t.call(this)||this;return i.renderManager=_t.getSingleton("RenderManager"),i.domManager=_t.getSingleton("DomManager"),i._layers=It,i._depth=0,i._zoom=1,i._originalViewportRect=new e(0,0,0,0),i._viewportRect=new e(0,0,0,0),i._worldSpaceRect=new e(0,0,0,0),i.cameraData=new Vt,i.allowMultiple=!1,i.type="Camera",i.canvas=i.domManager.canvas,i}return r(i,t),Object.defineProperty(i.prototype,"layers",{get:function(){return this._layers},set:function(t){this._layers=c(It,t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"depth",{get:function(){return this._depth},set:function(t){this._depth=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"zoom",{get:function(){return this._zoom},set:function(t){if(this.zoom<=0)throw new m("zoom must be greather than 0");this._zoom=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"originalViewportRect",{get:function(){return this._originalViewportRect},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"worldSpaceRect",{get:function(){return this._worldSpaceRect},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"viewportRect",{get:function(){return this._viewportRect},enumerable:!1,configurable:!0}),i.prototype.addLayer=function(t){this._layers.push(t)},i.prototype.update=function(){this.updateOriginalViewportRect(),this.updateViewportRect(),this.updateWorldSpaceRect(),this.updateCameraData()},i.prototype.updateOriginalViewportRect=function(){this._originalViewportRect.x=-this.canvas.width/2,this._originalViewportRect.y=-this.canvas.height/2,this._originalViewportRect.width=this.canvas.width,this._originalViewportRect.height=this.canvas.height},i.prototype.updateViewportRect=function(){var t=1/this._zoom;this._viewportRect.x=this._originalViewportRect.x*t,this._viewportRect.y=this._originalViewportRect.y*t,this._viewportRect.width=this._originalViewportRect.width*t,this._viewportRect.height=this._originalViewportRect.height*t},i.prototype.updateWorldSpaceRect=function(){this._worldSpaceRect.x=this.gameObject.transform.position.x-this._viewportRect.width/2,this._worldSpaceRect.y=this.gameObject.transform.position.y-this._viewportRect.height/2,this._worldSpaceRect.width=this._viewportRect.width,this._worldSpaceRect.height=this._viewportRect.height},i.prototype.updateCameraData=function(){this.cameraData.depth=this._depth,this.cameraData.layers=this._layers,this.cameraData.originalViewportRect=this._originalViewportRect,this.cameraData.viewportRect=this._viewportRect,this.cameraData.worldSpaceRect=this._worldSpaceRect,this.cameraData.zoom=this._zoom,this.renderManager.addCameraData(this.cameraData)},i}(Et),Ut=function(t){function e(){var e=t.call(this)||this;return e.transform.position.set(0,0),e.camera=e.addComponent((function(){return new Lt})),e}return r(e,t),Object.defineProperty(e.prototype,"layers",{get:function(){return this.camera.layers},set:function(t){this.camera.layers=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){return this.camera.depth},set:function(t){this.camera.depth=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoom",{get:function(){return this.camera.zoom},set:function(t){this.camera.zoom=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"originalViewporRect",{get:function(){return this.camera.originalViewportRect},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldSpaceRect",{get:function(){return this.camera.worldSpaceRect},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewportRect",{get:function(){return this.camera.viewportRect},enumerable:!1,configurable:!0}),e.prototype.addLayer=function(t){this.camera.layers.push(t)},e}(Ft),Ht=function(){function t(){var t=this;this.game=null,this.name=null,this.gameObjectManager=_t.getSingleton("GameObjectManager"),this.started=!1,this.gameLoopEventHandler=function(e){try{!1===t.started&&e.type===dt?(t.start(),t.started=!0):!0===t.started&&e.type===ft&&t.update()}catch(t){throw-1!==t.message.indexOf(m.messagePrefix)?t:new m(t.message)}},window.addEventListener(dt,this.gameLoopEventHandler),window.addEventListener(ft,this.gameLoopEventHandler),this.addGameObject((function(){return new Ut}),"GameCamera"),this.gameLoopEventHandler.bind(this)}return Object.defineProperty(t.prototype,"gameCamera",{get:function(){return this.findGameObjectByName("GameCamera")},enumerable:!1,configurable:!0}),t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.addGameObject=function(t,e){return this.gameObjectManager.addGameObject(t,e)},t.prototype.getGameObjects=function(){return this.gameObjectManager.getGameObjects()},t.prototype.findGameObjectByName=function(t){return this.gameObjectManager.findGameObjectByName(t)},t.prototype.findGameObjectsByTag=function(t){return this.gameObjectManager.findGameObjectsByTag(t)},t.prototype.findGameObjectByTag=function(t){return this.gameObjectManager.findGameObjectByTag(t)},t.prototype.destroyAllGameObjects=function(){this.gameObjectManager.destroyAllGameObjects()},t.prototype.destroyGameObjectByName=function(t){this.destroyGameObject(this.findGameObjectByName(t))},t.prototype.destroyGameObject=function(t){this.gameObjectManager.destroyGameObject(t)},t.prototype.destroy=function(){var t=this;window.removeEventListener(dt,this.gameLoopEventHandler),window.removeEventListener(ft,this.gameLoopEventHandler),this.gameObjectManager.destroyAllGameObjects(),Object.keys(this).forEach((function(e){return delete t[e]}))},t}(),zt=function(){function e(e){var i,n,r,o,a=this;this._image=null,this._slice=null,this._scale=null!==(i=_t.getConstant("GameConfig").spriteDefaultScale)&&void 0!==i?i:new t(1,1),this._smooth=!1,this._width=null,this._height=null,this._loaded=!1,this._image=e.image,this._slice=null!==(n=e.slice)&&void 0!==n?n:this._slice,null!==this._slice&&(this._width=this._slice.width,this._height=this._slice.height),this._scale=null!==(r=e.scale)&&void 0!==r?r:this._scale,this._smooth=null!==(o=e.smooth)&&void 0!==o?o:this._smooth,this._image.naturalWidth?this.onLoad():this._image.addEventListener("load",(function(){return a.onLoad()}))}return Object.defineProperty(e.prototype,"loaded",{get:function(){return this._loaded},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"image",{get:function(){return this._image},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"slice",{get:function(){return this._slice},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"smooth",{get:function(){return this._smooth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){var t,e;this._width=(null!==(t=this._width)&&void 0!==t?t:this._image.naturalWidth)*this._scale.x,this._height=(null!==(e=this._height)&&void 0!==e?e:this._image.naturalHeight)*this._scale.y,this._loaded=!0},e}(),kt=function(t){var e,i;this.sprites=[],this.speed=1,this.loop=!1,this.sprites=t.sprites,this.speed=null!==(e=t.speed)&&void 0!==e?e:this.speed,this.loop=null!==(i=t.loop)&&void 0!==i?i:this.loop},Nt=function(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n},Wt=(function(){function e(e){var i,n;this.image=null,this.offset=new t(0,0),this.tileSpacing=new t(0,0),this._tiles=[],this.image=e.image,this.tileWidth=e.tileWidth,this.tileHeight=e.tileHeight,this.gridWidth=e.gridWidth,this.gridHeight=e.gridHeight,this.offset=null!==(i=e.offset)&&void 0!==i?i:this.offset,this.tileSpacing=null!==(n=e.spacing)&&void 0!==n?n:this.tileSpacing,this.generateTiles()}e.prototype.generateTiles=function(){for(var t=0,e=0;e<this.gridHeight;e++)for(var i=0;i<this.gridWidth;i++)this._tiles[t]=new Nt(i*this.tileWidth+i*this.tileSpacing.x+this.offset.x,e*this.tileHeight+e*this.tileSpacing.y+this.offset.y,this.tileWidth,this.tileHeight),t++},e.prototype.getTile=function(t){return this._tiles[t]?this._tiles[t]:null},Object.defineProperty(e.prototype,"tiles",{get:function(){return this._tiles},enumerable:!1,configurable:!0})}(),function(e){function i(i,n,r,o){void 0===o&&(o=0);var a=e.call(this)||this;return a.cacheVector=new t,a.axes=[],a._type=d.Rectangle,a._position.set(i.x,i.y),a._width=n,a._height=r,a._angle=o,a._model=[new t(-n/2,-r/2),new t(-n/2,r/2),new t(n/2,r/2),new t(n/2,-r/2)],a._vertices=[new t,new t,new t,new t],a.axes=[new t,new t],a.update(),a}return r(i,e),i.prototype.update=function(){this.updateModel();for(var t=0;t<this._model.length;t++)this._vertices[t].set(this._model[t].x*Math.cos(this._angle)-this._model[t].y*Math.sin(this._angle)+this._position.x,this._model[t].x*Math.sin(this._angle)+this._model[t].y*Math.cos(this._angle)+this._position.y);this.updateDirection(),this.updateAxes()},i.prototype.updateModel=function(){this._model[0].set(-this._width/2,-this._height/2),this._model[1].set(-this._width/2,this._height/2),this._model[2].set(this._width/2,this._height/2),this._model[3].set(this._width/2,-this._height/2)},i.prototype.updateDirection=function(){t.unit(this._direction,t.subtract(this.cacheVector,this._vertices[1],this._vertices[0]))},i.prototype.updateAxes=function(){t.normal(this.axes[0],this._direction),this.axes[1].set(this._direction.x,this._direction.y)},i.prototype.clone=function(){return new i(this._position,this._width,this._height,this._angle)},i.prototype.getAxes=function(){return this.axes},i}(P)),qt=function(){function e(e,i,n,r,o,a){void 0===a&&(a=0),this._position=new t,this._width=0,this._height=0,this._angle=0,this._quadMaxBounds=new t,this._quadMinBounds=new t,this._position.set(e.x,e.y),this._quadVertices=[new t,new t,new t,new t],this._width=i,this._height=n,this._angle=a,this.gameObject=o,this.physics=r,this.shape=new Wt(this._position,this._width,this._height),this.updateQuadVertices()}return Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(t){this._position.set(t.x,t.y),this.updateShape(),this.updateQuadVertices()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this.updateShape(),this.updateQuadVertices()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this.updateShape(),this.updateQuadVertices()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeftQuadVertex",{get:function(){return this._quadVertices[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottomRightQuadVertex",{get:function(){return this._quadVertices[3]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topLeftQuadVertex",{get:function(){return this._quadVertices[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topRightQuadVertex",{get:function(){return this._quadVertices[2]},enumerable:!1,configurable:!0}),e.prototype.updateShape=function(){this.shape.position=this._position,this.shape.width=this._width,this.shape.height=this.height,this.shape.angle=this._angle,this.shape.update()},e.prototype.updateQuadVertices=function(){var t=this;this._quadMaxBounds.set(this.shape.vertices[0].x,this.shape.vertices[0].y),this._quadMinBounds.set(this.shape.vertices[0].x,this.shape.vertices[0].y),this.shape.vertices.forEach((function(e){t._quadMaxBounds.set(Math.max(e.x,t._quadMaxBounds.x),Math.max(e.y,t._quadMaxBounds.y)),t._quadMinBounds.set(Math.min(e.x,t._quadMinBounds.x),Math.min(e.y,t._quadMinBounds.y))})),this._quadVertices[0].set(this._quadMinBounds.x,this._quadMinBounds.y),this._quadVertices[1].set(this._quadMinBounds.x,this._quadMaxBounds.y),this._quadVertices[2].set(this._quadMaxBounds.x,this._quadMaxBounds.y),this._quadVertices[3].set(this._quadMaxBounds.x,this._quadMinBounds.y)},e}(),Qt=function(t){function e(){var e=t.call(this)||this;return e.collisionManager=_t.getSingleton("CollisionManager"),e.colliders=[],e._physics=!0,e.renderer=null,e.collisionsCache=[],e}return r(e,t),Object.defineProperty(e.prototype,"physics",{get:function(){return this._physics},enumerable:!1,configurable:!0}),e.prototype.addCollider=function(t){this.colliders.push(t),this.collisionManager.addCollider(t)},e.prototype.collidesWithLayer=function(t){return null!==this.getCollisionWithLayer(t)},e.prototype.getCollisionWithLayer=function(t){this.updatePosition();for(var e=0,i=this.colliders;e<i.length;e++)for(var n=i[e],r=0,o=this.collisionManager.getCollisionsForCollider(n);r<o.length;r++){var a=o[r];if(a.remoteCollider.gameObject.layer===t)return a}return null},e.prototype.getCollisionsWithLayer=function(t){this.updatePosition(),this.collisionsCache=[];for(var e=0,i=this.colliders;e<i.length;e++)for(var n=i[e],r=0,o=this.collisionManager.getCollisionsForCollider(n);r<o.length;r++){var a=o[r];a.remoteCollider.gameObject.layer===t&&this.collisionsCache.push(a)}return c(this.collisionsCache)},e.prototype.setActive=function(e){var i=this;!0===e&&!1===this.active?this.colliders.forEach((function(t){return i.collisionManager.addCollider(t)})):!1===e&&!0===this.active&&this.colliders.forEach((function(t){return i.collisionManager.removeCollider(t)})),this.renderer&&this.renderer.setActive(e),t.prototype.setActive.call(this,e)},e.prototype.destroy=function(){var e=this;this.colliders.forEach((function(t){return e.collisionManager.removeCollider(t)})),t.prototype.destroy.call(this)},e}(St),Yt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=u.Collider,e.color=null,e.shape=null,e}return r(e,t),e}(f),Xt=function(e){function i(i){var n,r,o,a,s,h=e.call(this)||this;return h.debug=!1,h.offsetX=0,h.offsetY=0,h.realWidth=0,h.realHeight=0,h.realOffset=new t,h.realPosition=new t,h.realRotation=0,h.applyRotation=_t.getConstant("GameConfig").collisions.method===k.SAT,h.innerPosition=new t,h.type="BoxCollider",h.width=i.width,h.height=i.height,h.offsetX=null!==(n=i.offsetX)&&void 0!==n?n:h.offsetX,h.offsetY=null!==(r=i.offsetY)&&void 0!==r?r:h.offsetY,h._physics=null!==(o=i.physics)&&void 0!==o?o:h._physics,h.debug=(null!==(a=i.debug)&&void 0!==a?a:h.debug)&&_t.getConstant("GameConfig").debugEnabled,h.rotation=null!==(s=i.rotation)&&void 0!==s?s:new Bt,h}return r(i,e),i.prototype.start=function(){var t=this;this.updateRealSize(),this.addCollider(new qt(this.gameObject.transform.position,this.realWidth,this.realHeight,this._physics,this.gameObject,this.realRotation)),this.debug&&(this.renderer=this.gameObject.addComponent((function(){return new Kt(t.colliders[0])})))},i.prototype.update=function(){this.updatePosition()},i.prototype.updatePosition=function(){this.updateRealSize(),this.colliders[0].width=this.realWidth,this.colliders[0].height=this.realHeight,this.colliders[0].position=t.add(this.realPosition,this.gameObject.transform.position,this.realOffset),0!==this.realRotation&&this.applyRotation&&(this.colliders[0].angle=this.realRotation),0!==this.gameObject.transform.rotation.radians&&this.translate()},i.prototype.updateRealSize=function(){this.realWidth=this.width*Math.abs(this.gameObject.transform.scale.x),this.realHeight=this.height*Math.abs(this.gameObject.transform.scale.y),this.realOffset.x=this.offsetX*this.gameObject.transform.scale.x,this.realOffset.y=this.offsetY*this.gameObject.transform.scale.y,this.realRotation=this.gameObject.transform.rotation.radians+this.rotation.radians},i.prototype.translate=function(){t.subtract(this.innerPosition,this.colliders[0].position,this.gameObject.transform.position);var e=Math.atan2(this.innerPosition.y,this.innerPosition.x)+this.gameObject.transform.rotation.radians;this.realPosition.set(this.gameObject.transform.position.x+this.innerPosition.magnitude*Math.cos(e),this.gameObject.transform.position.y+this.innerPosition.magnitude*Math.sin(e)),this.colliders[0].position=this.realPosition},i}(Qt),Kt=function(t){function e(e){var i=t.call(this)||this;return i.renderManager=_t.getSingleton("RenderManager"),i.type="BoxColliderRenderer",i.renderData=new Yt,i.renderData.debug=!0,i.renderData.color="#00FF00",i.collider=e,i}return r(e,t),e.prototype.update=function(){this.renderData.layer=this.gameObject.layer,this.renderData.position=this.collider.position,this.renderData.shape=this.collider.shape,this.renderManager.addRenderData(this.renderData)},e}(Dt),Zt=(function(e){function i(i){var n,r=e.call(this)||this;return r.tilemapRenderer=null,r.debug=!1,r.needsCollider=function(t){r.cacheVertex[0].set(t.position.x,t.position.y+t.height),r.cacheVertex[1].set(t.position.x+t.width,t.position.y),r.cacheVertex[2].set(t.position.x,t.position.y-t.height),r.cacheVertex[3].set(t.position.x-t.width,t.position.y);for(var e=function(t){if(void 0===r.tilemapRenderer.tilesData.find((function(e){return e.position.equals(r.cacheVertex[t])})))return{value:!0}},i=0;i<r.cacheVertex.length;i++){var n=e(i);if("object"==typeof n)return n.value}return!1},r.type="TilemapCollider",r.tilemapRenderer=i.tilemapRenderer,r.debug=(null!==(n=i.debug)&&void 0!==n?n:r.debug)&&_t.getConstant("GameConfig").debugEnabled,r._physics=!0,r.cacheVertex=[new t,new t,new t,new t],r}r(i,e),i.prototype.start=function(){var t=this;this.tilemapRenderer.tilesData.filter(this.needsCollider).forEach((function(e){t.addCollider(new qt(e.position,e.width,e.height,t._physics,t.gameObject))})),this.debug&&(this.renderer=this.gameObject.addComponent((function(){return new Zt(t.colliders)})))},i.prototype.updatePosition=function(){}}(Qt),function(t){function e(e){var i=t.call(this)||this;return i.renderManager=_t.getSingleton("RenderManager"),i.renderData=[],i.colliders=[],i.type="TilemapColliderRenderer",i.colliders=e,i.colliders.forEach((function(t,e){i.renderData[e]=new Yt,i.renderData[e].debug=!0,i.renderData[e].color="#00FF00"})),i}return r(e,t),e.prototype.update=function(){var t=this;this.colliders.forEach((function(e,i){t.renderData[i].layer=t.gameObject.layer,t.renderData[i].position=e.position,t.renderData[i].shape=e.shape,t.renderManager.addRenderData(t.renderData[i])}))},e}(Dt)),$t=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=u.Image,e.image=null,e.width=0,e.height=0,e.slice=null,e.flipHorizontal=!1,e.flipVertical=!1,e.rotation=0,e.smooth=!0,e.alpha=1,e.maskColor=null,e.maskColorMix=null,e}return r(e,t),e}(f),Jt=function(e){function i(i){var n,r,o,a,s,h,c,u,l;void 0===i&&(i={sprite:null});var p=e.call(this)||this;return p.renderManager=_t.getSingleton("RenderManager"),p.sprite=null,p.offset=new t,p.flipHorizontal=!1,p.flipVertical=!1,p.rotation=new Bt,p.smooth=!1,p.opacity=1,p._tiled=new t(1,1),p.maskColor="#ffffff",p.maskColorMix=0,p.renderData=[],p.innerPosition=new t,p.cachePosition=new t,p.cacheRenderPosition=new t,p.type="SpriteRenderer",p.sprite=i.sprite,p.offset=null!==(n=i.offset)&&void 0!==n?n:p.offset,p.smooth=null!==(r=i.smooth)&&void 0!==r?r:p.smooth,p.rotation=null!==(o=i.rotation)&&void 0!==o?o:p.rotation,p.flipHorizontal=null!==(a=i.flipHorizontal)&&void 0!==a?a:p.flipHorizontal,p.flipVertical=null!==(s=i.flipVertical)&&void 0!==s?s:p.flipVertical,p.opacity=null!==(h=i.opacity)&&void 0!==h?h:p.opacity,p.tiled=null!==(c=i.tiled)&&void 0!==c?c:p._tiled,p.maskColor=null!==(u=i.maskColor)&&void 0!==u?u:p.maskColor,p.maskColorMix=null!==(l=i.maskColorMix)&&void 0!==l?l:p.maskColorMix,p}return r(i,e),Object.defineProperty(i.prototype,"tiled",{get:function(){return this._tiled},set:function(t){if(t.x%1!=0||t.y%1!=0)throw new m("SpriteRenderer.tiled: Vector2 components must be integers");this._tiled.set(t.x,t.y)},enumerable:!1,configurable:!0}),i.prototype.update=function(){if(this.sprite&&!0===this.sprite.loaded){this.updateRenderDataArray();for(var t=0,e=0;e<this._tiled.x;e++)for(var i=0;i<this._tiled.y;i++)this.updateRenderData(t,e,i),t++}},i.prototype.updateRenderDataArray=function(){if(this.renderData.length!==this._tiled.x*this._tiled.y){this.renderData=[];for(var t=0;t<=this._tiled.x*this._tiled.y;t++)this.renderData[t]=new $t}},i.prototype.updateRenderData=function(t,e,i){this.renderData[t].ui=this.gameObject.ui,this.renderData[t].layer=this.gameObject.layer,this.renderData[t].image=this.sprite.image,this.renderData[t].width=this.sprite.width*Math.abs(this.gameObject.transform.scale.x),this.renderData[t].height=this.sprite.height*Math.abs(this.gameObject.transform.scale.y),this.renderData[t].slice=this.sprite.slice,this.renderData[t].flipHorizontal=this.flipHorizontal!==this.gameObject.transform.scale.x<0,this.renderData[t].flipVertical=this.flipVertical!==this.gameObject.transform.scale.y<0,this.renderData[t].rotation=this.gameObject.transform.rotation.radians+this.rotation.radians,this.renderData[t].smooth=this.sprite.smooth,this.renderData[t].alpha=this.opacity,this.renderData[t].maskColor=this.maskColor,this.renderData[t].maskColorMix=this.maskColorMix,this.calculateRenderPosition(t,e,i),this.renderManager.addRenderData(this.renderData[t])},i.prototype.calculateRenderPosition=function(e,i,n){t.add(this.cachePosition,this.gameObject.transform.position,this.offset),this.cacheRenderPosition.set(this.renderData[e].width/2*(this.tiled.x-1),this.renderData[e].height/2*(this.tiled.y-1)),t.subtract(this.cachePosition,this.cachePosition,this.cacheRenderPosition),this.cacheRenderPosition.set(i*this.renderData[e].width,n*this.renderData[e].height),t.add(this.cachePosition,this.cachePosition,this.cacheRenderPosition),this.renderData[e].position=this.cachePosition,0!==this.gameObject.transform.rotation.radians&&this.translateRenderPosition(e)},i.prototype.translateRenderPosition=function(e){t.subtract(this.innerPosition,this.renderData[e].position,this.gameObject.transform.position);var i=Math.atan2(this.innerPosition.y,this.innerPosition.x)+this.gameObject.transform.rotation.radians;this.renderData[e].position.set(this.gameObject.transform.position.x+this.innerPosition.magnitude*Math.cos(i),this.gameObject.transform.position.y+this.innerPosition.magnitude*Math.sin(i))},i}(Dt),te=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=u.Text,e.color=null,e.text=null,e.fontFamily=null,e.fontUrl=null,e.fontSize=null,e.lineSeparation=null,e.letterSpacing=null,e.pivot=null,e.bitmapSize=null,e.charRanges=null,e.smooth=!1,e.bitmapOffset=null,e}return r(e,t),e}(f),ee=function(e){function i(i){var n,r,o,a,s,h,c,u,l,p,d=e.call(this)||this;if(d.text=null,d.fontFamily="Sans",d.fontUrl=null,d.size=12,d.color="#000000",d.lineSeparation=0,d.letterSpacing=0,d.pivot="left",d.bitmapSize=64,d.charRanges=[32,126,161,255],d.smooth=!1,d.bitmapOffset=new t,d.renderManager=_t.getSingleton("RenderManager"),d.renderData=new te,d.type="TextRenderer",d.text=i.text,d.fontFamily=i.fontFamily,d.fontUrl=null!==(n=i.fontUrl)&&void 0!==n?n:d.fontUrl,d.size=null!==(r=i.size)&&void 0!==r?r:d.size,d.color=null!==(o=i.color)&&void 0!==o?o:d.color,d.lineSeparation=null!==(a=i.lineSeparation)&&void 0!==a?a:d.lineSeparation,d.letterSpacing=null!==(s=i.letterSpacing)&&void 0!==s?s:d.letterSpacing,d.pivot=null!==(h=i.pivot)&&void 0!==h?h:d.pivot,d.bitmapSize=null!==(c=i.bitmapSize)&&void 0!==c?c:d.bitmapSize,d.charRanges=null!==(u=i.charRanges)&&void 0!==u?u:d.charRanges,d.smooth=null!==(l=i.smooth)&&void 0!==l?l:d.smooth,d.bitmapOffset=null!==(p=i.bitmapOffset)&&void 0!==p?p:d.bitmapOffset,d.charRanges.length%2!=0)throw new m("TextRenderer.charRanges must be a 2 column matrix");if(d.lineSeparation%2!=0)throw new m("TextRenderer.lineSeparation must be multiple of 2");return d}return r(i,e),i.prototype.start=function(){if(!1===this.gameObject.ui)throw new m("TextRenderer only can be used on UI GameObjects");this.renderData.layer=this.gameObject.layer,this.renderData.ui=this.gameObject.ui,this.renderData.fontFamily=this.fontFamily,this.renderData.fontUrl=this.fontUrl,this.renderData.lineSeparation=this.lineSeparation,this.renderData.letterSpacing=this.letterSpacing,this.renderData.pivot=this.pivot,this.renderData.bitmapSize=this.bitmapSize,this.renderData.charRanges=this.charRanges,this.renderData.smooth=this.smooth,this.renderData.bitmapOffset=this.bitmapOffset},i.prototype.update=function(){if(!1===this.gameObject.ui)throw new m("TextRenderer only can be used on UI GameObjects");this.renderData.text=this.text,this.renderData.fontSize=this.size,this.renderData.color=this.color,this.renderData.position.set(this.gameObject.transform.position.x,this.gameObject.transform.position.y),this.renderManager.addRenderData(this.renderData)},i}(Dt),ie=function(){function e(e,i,n){this._position=new t,this._position.set(e.x,e.y),this._width=i,this._height=n}return Object.defineProperty(e.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e}(),ne=function(){this.position=new t,this.positionInViewport=new t},re=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=u.Tilemap,e.tilesData=[],e.tilesToRender=[],e}return r(e,t),e}(f),oe=function(e){function i(i){var n,r,o,a,s,h=e.call(this)||this;return h.renderOrder="center",h.smooth=!1,h.textureCorrection=null,h.tileScale=null!==(n=_t.getConstant("GameConfig").spriteDefaultScale)&&void 0!==n?n:new t(1,1),h.tileWidth=0,h.tileHeight=0,h.orientation=new t(1,1),h.renderManager=_t.getSingleton("RenderManager"),h.tilemapProcessed=!1,h.renderData=new Map,h.cols=[],h.rows=[],h._width=0,h._height=0,h.tiles=[],h._realWidth=0,h._realHeight=0,h.cacheV2=new t,h.allowMultiple=!1,h.tileset=i.tileset,h.tileScale=null!==(r=i.tileScale)&&void 0!==r?r:h.tileScale,h.smooth=null!==(o=i.smooth)&&void 0!==o?o:h.smooth,h.renderOrder=null!==(a=i.renderOrder)&&void 0!==a?a:h.renderOrder,h.textureCorrection=null!==(s=i.textureCorrection)&&void 0!==s?s:h.textureCorrection,h}return r(i,e),i.prototype.start=function(){this.tileWidth=this.tileset.tileWidth*this.tileScale.x*Math.abs(this.gameObject.transform.scale.x),this.tileHeight=this.tileset.tileHeight*this.tileScale.y*Math.abs(this.gameObject.transform.scale.y),this.orientation.set(Math.sign(this.gameObject.transform.scale.x),Math.sign(this.gameObject.transform.scale.y)),this.processTilemap(),this.updatePosition()},i.prototype.update=function(){var t=this;this.renderData.forEach((function(e){return t.renderManager.addRenderData(e)}))},i.prototype.processTile=function(t,e,i,n,r,o){void 0===n&&(n=1),void 0===r&&(r={h:!1,v:!1}),void 0===o&&(o={x:0,y:0}),null!==t&&this.addTileToRenderData(t,e,i,n,r,o),this.updateSizeInfo(e,i)},i.prototype.addTileToRenderData=function(t,e,i,n,r,o){!1===this.renderData.has(n)&&this.renderData.set(n,this.createRenderDataForAlpha(n));var a=new ne;a.tile=t,a.position.set(this.gameObject.transform.position.x+e*this.tileWidth*this.orientation.x+o.x*Math.abs(this.gameObject.transform.scale.x)+this.tileWidth*this.orientation.x/2,this.gameObject.transform.position.y-i*this.tileHeight*this.orientation.y-o.y*Math.abs(this.gameObject.transform.scale.y)-this.tileHeight*this.orientation.y/2),a.flipHorizontal=r.h!==this.orientation.x<0,a.flipVertical=r.v!==this.orientation.y<0,this.renderData.get(n).tilesData.push(a)},i.prototype.createRenderDataForAlpha=function(t){var e=new re;return e.ui=!1,e.alpha=t,e.image=this.tileset.image,e.layer=this.gameObject.layer,e.smooth=this.smooth,e.tileWidth=this.tileWidth,e.tileHeight=this.tileHeight,e.textureCorrection=this.textureCorrection,e},i.prototype.updateSizeInfo=function(t,e){this._width=!1===this.cols.includes(t)?this.cols.push(t):this._width,this._height=!1===this.rows.includes(e)?this.rows.push(e):this._height,this._realWidth=this._width*this.tileWidth,this._realHeight=this._height*this.tileHeight},i.prototype.updatePosition=function(){var e=this;this.cacheV2.set(("center"===this.renderOrder?-Math.round(this._realWidth/2):["left-down","left-up"].includes(this.renderOrder)?-this._realWidth:0)*this.orientation.x,("center"===this.renderOrder?Math.round(this._realHeight/2):["right-up","left-up"].includes(this.renderOrder)?this._realHeight:0)*this.orientation.y),this.renderData.forEach((function(i){return i.tilesData.forEach((function(i){t.add(i.position,i.position,e.cacheV2),e.addTileData(i)}))}))},i.prototype.addTileData=function(t){this.tiles.push(new ie(t.position,this.tileWidth,this.tileHeight))},Object.defineProperty(i.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"realWidth",{get:function(){return this._realWidth},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"realHeight",{get:function(){return this._realHeight},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tilesData",{get:function(){return this.tiles},enumerable:!1,configurable:!0}),i}(Dt),ae=(function(t){function e(e){var i,n=this;return e.renderOrder=e.tilemapData.renderorder,(n=t.call(this,e)||this).type="TiledRenderer",n.tiledTilemap=e.tilemapData,n.layerName=null!==(i=e.layerName)&&void 0!==i?i:null,n}r(e,t),e.prototype.processTilemap=function(){var t=this;this.tiledTilemap.layers.forEach((function(e){var i,n;!0!==e.visible||null!==t.layerName&&t.layerName!==e.name||(!0===t.tiledTilemap.infinite?e.chunks.forEach((function(i){var n,r;return t.processChunk(i,e.opacity,{x:null!==(n=e.offsetx)&&void 0!==n?n:0,y:null!==(r=e.offsety)&&void 0!==r?r:0})})):t.processChunk(e,e.opacity,{x:null!==(i=e.offsetx)&&void 0!==i?i:0,y:null!==(n=e.offsety)&&void 0!==n?n:0}))})),this.tilemapProcessed=!0},e.prototype.processChunk=function(t,e,i){void 0===e&&(e=1),void 0===i&&(i={x:0,y:0});for(var n=0,r=0;r<t.height;r++)for(var o=0;o<t.width;o++){var a=this.tileset.getTile(t.data[n]-1);this.processTile(a,o+t.x,r+t.y,e,{h:!1,v:!1},i),n++}}}(oe),1),se=2,he=3,ce=(function(t){function e(e){var i,n=t.call(this,e)||this;return n.alpha=1,n.type="TilemapRenderer",n.tilemapData=e.tilemapData,n.alpha=null!==(i=e.alpha)&&void 0!==i?i:n.alpha,n}r(e,t),e.prototype.processTilemap=function(){var t=this;this.tilemapData.trim().split("\n").forEach((function(e,i){e.split(",").forEach((function(e,n){var r=parseInt(e.trim()),o=null,a={h:!1,v:!1};if(!1===isNaN(r)){var s=r>999?r%1e3:r,h=Math.round(r/1e3);o=t.tileset.getTile(s),a.h=[ae,he].includes(h),a.v=[se,he].includes(h)}t.processTile(o,n,i,t.alpha,a)}))})),this.tilemapProcessed=!0}}(oe),function(t){function e(e){var i=t.call(this)||this;return i.timeManager=_t.getSingleton("TimeManager"),i.spriteRenderer=null,i.animations=new Map,i.currentAnimation=null,i.defaultSprite=null,i.type="Animator",i.spriteRenderer=e.spriteRenderer,i}return r(e,t),e.prototype.start=function(){this.defaultSprite=this.spriteRenderer.sprite},e.prototype.update=function(){null!==this.currentAnimation?(this.currentAnimation.playFrame(this.timeManager.deltaTime),!0===this.currentAnimation.restarted&&!1===this.currentAnimation.loop?this.stopAnimation():this.spriteRenderer.sprite=this.currentAnimation.sprite):this.spriteRenderer.sprite=this.defaultSprite},e.prototype.addAnimation=function(t,e){return this.animations.set(t,new ue(e)),this},e.prototype.playAnimation=function(t){if(!1!==this.active){if(!1===this.animations.has(t))throw new m("Animation with name "+t+" does not exist.");this.currentAnimation=this.animations.get(t)}},e.prototype.stopAnimation=function(){!1!==this.active&&null!==this.currentAnimation&&(this.currentAnimation=null)},e.prototype.isPlayingAnimation=function(t){return this.animations.get(t)&&this.animations.get(t)===this.currentAnimation},e}(Rt)),ue=function(){function t(t){this._sprite=null,this._restarted=!1,this.currentFrame=0,this.frameTime=0,this._animation=t}return Object.defineProperty(t.prototype,"sprite",{get:function(){return this._sprite},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"restarted",{get:function(){return this._restarted},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._animation.loop},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animation",{get:function(){return this._animation},enumerable:!1,configurable:!0}),t.prototype.playFrame=function(t){this._restarted=!1,this.frameTime>=1/(24*this._animation.speed)&&(this.frameTime=0,this.currentFrame=this.currentFrame+1===this._animation.sprites.length?0:this.currentFrame+1,this._restarted=0===this.currentFrame),this._sprite=this._animation.sprites[this.currentFrame],this.frameTime+=t},t}(),le=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","pointerup","touchend","keydown","keyup"],pe="AudioPlayer",de=function(t){function e(e){var i,n,r;void 0===e&&(e={audio:null,volume:1,loop:!1});var o=t.call(this)||this;return o.volume=1,o.loop=!1,o.audio=null,o.clones=new Map,o._playing=!1,o._paused=!1,o.audioEventHandler=function(t){"ended"===t.type&&(o._playing=!1,o.audio.removeEventListener("ended",o.audioEventHandler))},o.userinputEventHandler=function(){le.forEach((function(t){window.removeEventListener(t,o.userinputEventHandler)})),o.audio.play()},o.allowMultiple=!1,o.type="AudioPlayer",o.audio=null!==(i=e.audio)&&void 0!==i?i:o.audio,o.volume=null!==(n=e.volume)&&void 0!==n?n:o.volume,o.loop=null!==(r=e.loop)&&void 0!==r?r:o.loop,o}return r(e,t),e.prototype.playAudio=function(t,e){void 0===e&&(e=null),!1===this.clones.has(Symbol.for(t.src))&&this.cloneAudio(t);var i=this.clones.get(Symbol.for(t.src));i.currentTime>0&&(i.currentTime=0),i.volume=null!=e?e:this.volume,i.play()},e.prototype.cloneAudio=function(t){var e=t.cloneNode();this.clones.set(Symbol.for(t.src),e)},e.prototype.play=function(){var t=this;if(null!==this.audio&&(!this._playing||!1!==this._paused)){if(this._paused)return this._paused=!1,void this.audio.play();this.audio.volume=this.volume,this.audio.loop=this.loop,this.audio.addEventListener("ended",this.audioEventHandler),this._playing=!0,this.audio.play().then((function(){})).catch((function(){return le.forEach((function(e){return window.addEventListener(e,t.userinputEventHandler)}))}))}},e.prototype.stop=function(){this._playing&&(this.audio.pause(),this.audio.currentTime=0,this.audio.removeEventListener("ended",this.audioEventHandler),this._playing=!1,this._paused=!1)},e.prototype.pause=function(){this._playing&&!1===this._paused&&(this.audio.pause(),this._paused=!0)},e.prototype.setActive=function(e){!1===e&&this.stop(),t.prototype.setActive.call(this,e)},e.prototype.destroy=function(){this.stop(),t.prototype.destroy.call(this)},e}(Rt);!function(t){t[t.Static=0]="Static",t[t.Dynamic=1]="Dynamic"}(Ot||(Ot={}));var fe,ge=function(e){function i(i){var n,r,o=e.call(this)||this;return o.timeManager=_t.getSingleton("TimeManager"),o.gravityScale=9.8,o.velocityScale=60,o._colliderComponents=[],o._layersToCollide=[],o._velocity=new t,o._gravity=new t(0,1),o.deltaGravity=new t,o.deltaVelocity=new t,o.collisions=[],o.penetrationPerDirection={x:new Map,y:new Map},o.updatePosition=!1,o.penetrationResolution=new t,o.nextObjectPosition=new t,o.type="RigidBody",o.allowMultiple=!1,o._rigidBodyType=i.rigidBodyType,o._layersToCollide=null!==(n=i.layersToCollide)&&void 0!==n?n:o._layersToCollide,o._gravity.set(0,null!==(r=i.gravity)&&void 0!==r?r:o._gravity.y),o}return r(i,e),Object.defineProperty(i.prototype,"rigidBodyType",{get:function(){return this._rigidBodyType},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"velocity",{get:function(){return this._velocity},set:function(t){this._velocity.set(t.x,t.y)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"gravity",{get:function(){return this._gravity.y},set:function(t){this._gravity.set(this._gravity.x,t)},enumerable:!1,configurable:!0}),i.prototype.start=function(){var t=this;if(this.gameObject.getComponents().forEach((function(e){return e instanceof Qt&&e.physics?t._colliderComponents.push(e):null})),0===this._colliderComponents.length)throw new m("RigidBody needs at least one Collider")},i.prototype.update=function(){this._rigidBodyType!==Ot.Static&&(this.applyGravity(),this.deltaVelocity.set(0,0),this.applyVelocity("x"),this.applyReposition("x"),this.deltaVelocity.set(0,0),this.applyVelocity("y"),this.applyReposition("y"))},i.prototype.applyGravity=function(){this._gravity.y<=0||(this._velocity=t.add(this._velocity,this._velocity,t.scale(this.deltaGravity,this._gravity,-this.gravityScale*this.timeManager.physicsDeltaTime)))},i.prototype.applyVelocity=function(e){this.deltaVelocity[e]=this._velocity[e]*this.velocityScale*this.timeManager.physicsDeltaTime,0===this.deltaVelocity.x&&0===this.deltaVelocity.y||(this.gameObject.transform.position=t.add(this.nextObjectPosition,this.gameObject.transform.position,this.deltaVelocity))},i.prototype.applyReposition=function(t){var e=this;0!==this._layersToCollide.length&&(this.updatePosition=!1,this.penetrationResolution.set(this.gameObject.transform.position.x,this.gameObject.transform.position.y),this.penetrationPerDirection[t].clear(),this.updateCollisions(),0!==this.collisions.length&&(this.collisions.forEach((function(i){!0===i.remoteCollider.physics&&null!==i.remoteCollider.gameObject.getComponentByType("RigidBody")&&0!==i.collisionData.displacementDirection[t]&&e.setPenetrationPerDirectionPerAxis(t,i)})),this.setPenetrationResolution(t),this.updatePosition&&(this.gameObject.transform.position=this.penetrationResolution)))},i.prototype.setPenetrationPerDirectionPerAxis=function(t,e){var i;this.penetrationPerDirection[t].set(e.collisionData.displacementDirection[t],Math.max(null!==(i=this.penetrationPerDirection[t].get(e.collisionData.displacementDirection[t]))&&void 0!==i?i:0,e.collisionData.penetration))},i.prototype.setPenetrationResolution=function(t){var e=this;this.penetrationPerDirection[t].forEach((function(i,n){e.penetrationResolution[t]+=n*i,0!==e._velocity[t]&&Math.sign(e._velocity[t])!==Math.sign(n)&&(e._velocity[t]=0),e.updatePosition=!0}))},i.prototype.updateCollisions=function(){var t=this;this.collisions=[],this._colliderComponents.forEach((function(e){return t._layersToCollide.forEach((function(i){return e.getCollisionsWithLayer(i).forEach((function(e){return t.collisions.push(e)}))}))}))},i}(Tt),me=(function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.mousePressed=!1,i.position=new t,i}r(i,e),i.prototype.start=function(){this.camera=this.getCurrentScene().gameCamera},i.prototype.update=function(){ct.mouse.leftButtonPressed&&!1===this.mousePressed&&(t.scale(this.position,ct.mouse.positionInViewport,1/this.camera.zoom),t.add(this.position,this.position,this.camera.worldSpaceRect.center),t.round(this.position,this.position),console.log("Space position: {x: "+this.position.x+", y: "+this.position.y+"}")),this.mousePressed=ct.mouse.leftButtonPressed}}(Ft),fe=function(t,e){return(fe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}fe(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ye=function(e){function i(){var i=e.call(this)||this;return i.position=new t,i.moveSpeed=240,i.startPosition=396,i.endPosition=-148,i.layer="Background",i.addComponent((function(){return new Jt({sprite:new zt({image:st.getImage("image/desert-backgorund.png"),smooth:!1}),tiled:new t(1,3)})})),i.position.y=i.startPosition,i}return me(i,e),i.prototype.update=function(){this.position.y-=this.moveSpeed*lt.deltaTime,this.position.y<=this.endPosition&&(this.position.y=this.startPosition),this.transform.position=this.position},i}(Ft),be=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ve=function(e){function n(i,n){void 0===n&&(n=!1);var r=e.call(this)||this;return r.direction=new t(0,-1),r.velocity=new t,r.position=new t,r.speed=i,r.zigzag=n,r}return be(n,e),n.prototype.start=function(){this.zigzag&&(this.direction.x=i(-1,1))},n.prototype.update=function(){this.zigzag&&this.applyZigzag(),t.scale(this.velocity,this.direction,this.speed*lt.deltaTime),this.gameObject.transform.position=t.add(this.position,this.gameObject.transform.position,this.velocity)},n.prototype.applyZigzag=function(){var t=this.gameObject.collider.getCollisionWithLayer("StageBounds");t&&0!==t.collisionData.displacementDirection.x&&(this.direction.x=t.collisionData.displacementDirection.x)},n}(Ct),xe=function(){return new kt({loop:!1,speed:.5,sprites:[0,16,32,48,64].map((function(t){return new zt({image:st.getImage("image/explosion.png"),slice:{x:t,y:0,width:16,height:16},smooth:!1})}))})},we=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),_e=function(e){function i(i,n,r,o){var a=e.call(this)||this;return a.explosionAudio=st.getAudio("audio/enemy-explosion.mp3"),a.position=new t,a.dead=!1,a.layer="Enemy",a.type=r,a.score=o,a.spriteRenderer=a.addComponent((function(){return new Jt})),a.animator=a.addComponent((function(){return new ce({spriteRenderer:a.spriteRenderer})})).addAnimation("Explosion",xe()),a.audioPlayer=a.addComponent((function(){return new de({volume:1})})),a.position.set(i,n),a}return we(i,e),i.prototype.start=function(){this.gameController=this.findGameObjectByName("GameController"),this.enemySpawner=this.findGameObjectByName("EnemySpawner"),this.animator.playAnimation("Fly")},i.prototype.update=function(){!1===this.dead&&this.transform.position.y<=Ee&&this.enemySpawner.restoreEnemy(this),!1===this.dead&&this.collider.collidesWithLayer("PlayerProjectile")&&(this.collider.setActive(!1),this.animator.playAnimation("Explosion"),this.audioPlayer.playAudio(this.explosionAudio),this.dead=!0,this.gameController.score+=this.score),this.dead&&!1===this.animator.isPlayingAnimation("Explosion")&&this.enemySpawner.restoreEnemy(this)},i.prototype.respawn=function(){this.dead=!1,this.collider.setActive(!0),this.animator.playAnimation("Fly")},i}(Ft),Oe=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),je=function(t){function e(e,i){var n=t.call(this,e,i,"big",100)||this;return n.animator.addAnimation("Fly",new kt({loop:!0,speed:.5,sprites:[0,32].map((function(t){return new zt({image:st.getImage("image/enemy-big.png"),slice:{x:t,y:0,width:32,height:32},smooth:!1})}))})),n.collider=n.addComponent((function(){return new Xt({width:64,height:64,debug:!0,physics:!1})})),n.addComponent((function(){return new ve(300)})),n}return Oe(e,t),e}(_e),Me=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Pe=function(t){function e(e,i){var n=t.call(this,e,i,"medium",50)||this;return n.animator.addAnimation("Fly",new kt({loop:!0,speed:.5,sprites:[0,32].map((function(t){return new zt({image:st.getImage("image/enemy-medium.png"),slice:{x:t,y:0,width:32,height:16},smooth:!1})}))})),n.collider=n.addComponent((function(){return new Xt({width:64,height:32,debug:!0,physics:!1})})),n.addComponent((function(){return new ve(400,!0)})),n}return Me(e,t),e}(_e),Ce=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Re=function(t){function e(e,i){var n=t.call(this,e,i,"small",25)||this;return n.animator.addAnimation("Fly",new kt({loop:!0,speed:.5,sprites:[0,16].map((function(t){return new zt({image:st.getImage("image/enemy-small.png"),slice:{x:t,y:0,width:16,height:16},smooth:!1})}))})),n.collider=n.addComponent((function(){return new Xt({width:32,height:32,debug:!0,physics:!1})})),n.addComponent((function(){return new ve(500,!0)})),n}return Ce(e,t),e}(_e),Se=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Te={small:.4,medium:.8,big:1.8},Ae=[-200,200],Ee=-428,De=function(e){function n(){var i=e.call(this)||this;return i.spawnPosition=new t(0,428),i.pool={small:[],medium:[],big:[]},i.timer={small:0,medium:0,big:0},i}return Se(n,e),n.prototype.start=function(){for(var t=0;t<10;t++)this.addEnemyToPool(pt.addGameObject((function(){return new Re(0,0)}),"EnemySmall"+t)),this.addEnemyToPool(pt.addGameObject((function(){return new Pe(0,0)}),"EnemyMedium"+t)),this.addEnemyToPool(pt.addGameObject((function(){return new je(0,0)}),"EnemyBig"+t))},n.prototype.addEnemyToPool=function(t){t.setActive(!1),this.pool[t.type].push(t)},n.prototype.update=function(){this.updateTimers(),this.spawn("small"),this.spawn("medium"),this.spawn("big")},n.prototype.updateTimers=function(){this.timer.small+=lt.deltaTime,this.timer.medium+=lt.deltaTime,this.timer.big+=lt.deltaTime},n.prototype.spawn=function(t){if(!(this.timer[t]<Te[t])&&(this.timer[t]=0,0!==this.pool[t].length)){this.spawnPosition.x=i(Ae[0],Ae[1]);var e=this.pool[t].pop();e.transform.position=this.spawnPosition,e.setActive(!0),e.respawn()}},n.prototype.restoreEnemy=function(t){t.setActive(!1),this.pool[t.type].push(t)},n}(Ft),Be=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ge=function(t){function e(){var e=t.call(this)||this;return e.muting=!1,e.muted=!0,e.score=0,e.pausing=!1,e.paused=!1,e.restarting=!1,e.restartTimer=0,e.audioPlayer=e.addComponent((function(){return new de({audio:st.getAudio("audio/spaceship-shooter.mp3"),loop:!0,volume:.5})})),e}return Be(e,t),e.prototype.start=function(){this.inputController=this.findGameObjectByName("InputController"),this.playerStatus=this.findGameObjectByName("Player").getComponentByName("PlayerStatus"),this.gameOverUI=this.findGameObjectByName("GameOverUI"),this.gameOverUI.setActive(!1),this.pausing=!0,!1===this.muted&&this.audioPlayer.play()},e.prototype.update=function(){0===this.playerStatus.lifes&&(this.gameOverUI.setActive(!0),this.restarting=!0),this.pause(),this.mute(),this.restart()},e.prototype.pause=function(){!1===this.pausing&&this.inputController.pause&&(this.paused=!this.paused,lt.setTimeScale(this.paused?0:1),this.paused?this.audioPlayer.pause():!1===this.muted&&this.audioPlayer.play()),this.pausing=this.inputController.pause},e.prototype.mute=function(){this.paused||(!1===this.muting&&this.inputController.mute&&(this.muted=!this.muted,this.muted?this.audioPlayer.stop():this.audioPlayer.play()),this.muting=this.inputController.mute)},e.prototype.restart=function(){!1!==this.restarting&&(this.restartTimer+=lt.deltaTime,this.restartTimer>=5&&ut.loadScene("StartScene"))},e}(Ft),Fe=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ve=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.axes=new t,i.fire=!1,i.pause=!1,i.mute=!1,i.enter=!1,i.quit=!1,i.keyboard=ct.keyboard,i.gamepad=ct.gamepad.getGamepad(0),i}return Fe(i,e),i.prototype.update=function(){this.axes.x=this.keyboard.isPressed("ArrowLeft")?-1:this.keyboard.isPressed("ArrowRight")?1:0,this.axes.y=this.keyboard.isPressed("ArrowDown")?-1:this.keyboard.isPressed("ArrowUp")?1:0,this.fire=this.keyboard.isPressed("KeyF"),this.pause=this.keyboard.isPressed("KeyP"),this.mute=this.keyboard.isPressed("KeyM"),this.enter=this.keyboard.isPressed("Enter"),this.quit=this.keyboard.isPressed("KeyQ"),this.gamepad&&this.updateGamepad()},i.prototype.updateGamepad=function(){this.axes.set(this.gamepad.dpadRight?1:this.gamepad.dpadLeft?-1:this.axes.x,this.gamepad.dpadUp?1:this.gamepad.dpadDown?-1:this.axes.y),this.axes.set(this.gamepad.leftStickHorizontal>.1||this.gamepad.leftStickHorizontal<-.1?Math.sign(this.gamepad.leftStickHorizontal):this.axes.x,this.gamepad.leftStickVertical>.1||this.gamepad.leftStickVertical<-.1?Math.sign(this.gamepad.leftStickVertical):this.axes.y),this.fire=this.gamepad.leftFace||this.fire,this.pause=this.gamepad.start||this.pause,this.enter=this.gamepad.start||this.enter,this.mute=this.gamepad.back||this.mute},i}(Ft),Ie=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Le=new t(0,-360),Ue=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.explosionAudio=st.getAudio("audio/player-explosion.mp3"),e.alive=!0,e.invulnerable=!1,e.lifes=3,e.respawning=!1,e.respawnTimer=0,e.invulnerabilityTimer=0,e}return Ie(e,t),e.prototype.start=function(){this.collider=this.getComponentByType("BoxCollider"),this.animator=this.getComponentByType("Animator"),this.spriteRenderer=this.getComponentByType("SpriteRenderer"),this.audioPlayer=this.getComponentByType(pe),this.gameObject.transform.position=Le,this.animator.playAnimation("Fly")},e.prototype.update=function(){this.getHit(),this.respawn(),this.getInvulnerable()},e.prototype.getHit=function(){this.alive&&!1===this.invulnerable&&this.collider.collidesWithLayer("Enemy")&&(this.alive=!1,this.animator.playAnimation("Explosion"),this.audioPlayer.playAudio(this.explosionAudio,.4),this.lifes-=1,this.lifes>0&&(this.respawning=!0))},e.prototype.respawn=function(){!1!==this.respawning&&(this.respawnTimer<2?this.respawnTimer+=lt.deltaTime:(this.respawning=!1,this.respawnTimer=0,this.getAlive()))},e.prototype.getAlive=function(){this.alive=!0,this.invulnerable=!0,this.gameObject.transform.position=Le,this.animator.playAnimation("Fly")},e.prototype.getInvulnerable=function(){!1!==this.invulnerable&&(this.invulnerabilityTimer+=lt.deltaTime,this.invulnerabilityTimer<3?this.spriteRenderer.opacity=.5:(this.spriteRenderer.opacity=1,this.invulnerable=!1,this.invulnerabilityTimer=0))},e}(Ct),He=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ze=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.speed=400,i.velocity=new t,i.position=new t,i}return He(i,e),i.prototype.start=function(){this.playerStatus=this.getComponentByName("PlayerStatus"),this.inputController=this.findGameObjectByName("InputController")},i.prototype.update=function(){!1!==this.playerStatus.alive&&(t.scale(this.velocity,this.inputController.axes,this.speed*lt.deltaTime),this.gameObject.transform.position=t.add(this.position,this.gameObject.transform.position,this.velocity))},i}(Ct),ke=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ne=function(e){function i(){var i=e.call(this)||this;return i.fire=!1,i.position=new t,i.velocity=new t,i.layer="PlayerProjectile",i.spriteRenderer=i.addComponent((function(){return new Jt})),i.animator=i.addComponent((function(){return new ce({spriteRenderer:i.spriteRenderer})})).addAnimation("Default",new kt({loop:!0,speed:.5,sprites:[0,16].map((function(t){return new zt({image:st.getImage("image/laser-bolts.png"),smooth:!1,slice:{x:t,y:16,width:16,height:16}})}))})),i.collider=i.addComponent((function(){return new Xt({width:20,height:32,physics:!1,debug:!0})})),i}return ke(i,e),i.prototype.start=function(){this.playerWeapon=this.findGameObjectByName("Player").getComponentByName("PlayerWeapon"),this.animator.playAnimation("Default")},i.prototype.update=function(){this.fire&&(this.velocity.y=600*lt.deltaTime,this.transform.position=t.add(this.position,this.transform.position,this.velocity)),this.collider.collidesWithLayer("StageBounds")&&this.playerWeapon.restoreProjectile(this),this.collider.collidesWithLayer("Enemy")&&this.playerWeapon.restoreProjectile(this)},i}(Ft),We=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),qe=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.projectiles=[],e.fireAudio=st.getAudio("audio/player-weapon.mp3"),e.fire=!1,e}return We(e,t),e.prototype.start=function(){this.gameController=this.findGameObjectByName("GameController"),this.playerStatus=this.getComponentByName("PlayerStatus"),this.inputController=this.findGameObjectByName("InputController"),this.audioPlayer=this.getComponentByType(pe),this.setupProjectiles()},e.prototype.setupProjectiles=function(){for(var t=0;t<50;t++){var e=pt.addGameObject((function(){return new Ne}),"PlayerProjectile"+t);e.setActive(!1),this.projectiles.push(e)}},e.prototype.update=function(){if(!this.gameController.paused&&!1!==this.playerStatus.alive&&0!==this.projectiles.length){if(!1===this.fire&&this.inputController.fire){var t=this.projectiles.pop();t.setActive(!0),t.transform.position=this.gameObject.transform.position,t.fire=!0,this.audioPlayer.playAudio(this.fireAudio,.1)}this.fire=this.inputController.fire}},e.prototype.restoreProjectile=function(t){t.setActive(!1),t.fire=!1,this.projectiles.push(t)},e}(Ct),Qe=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ye=function(t){function e(){var e=t.call(this)||this;return e.layer="Player",e.spriteRenderer=e.addComponent((function(){return new Jt})),e.addComponent((function(){return new ce({spriteRenderer:e.spriteRenderer})})).addAnimation("Fly",new kt({loop:!0,speed:.5,sprites:[0,24].map((function(t){return new zt({image:st.getImage("image/ship.png"),slice:{x:32,y:t,width:16,height:24},smooth:!1})}))})).addAnimation("Explosion",xe()),e.addComponent((function(){return new Xt({width:32,height:48,debug:!0})})),e.addComponent((function(){return new ge({rigidBodyType:Ot.Dynamic,layersToCollide:["StageBounds"],gravity:0})})),e.addComponent((function(){return new de})),e.addComponent((function(){return new ze}),"PlayerMovements"),e.addComponent((function(){return new qe}),"PlayerWeapon"),e.addComponent((function(){return new Ue}),"PlayerStatus"),e}return Qe(e,t),e}(Ft),Xe=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ke=function(t){function e(){var e=t.call(this)||this;return e.layer="StageBounds",[-428,428].forEach((function(t){return e.addComponent((function(){return new Xt({width:512,height:10,offsetY:t,debug:!0})}))})),[-264,264].forEach((function(t){return e.addComponent((function(){return new Xt({width:10,height:840,offsetX:t,debug:!0})}))})),e.addComponent((function(){return new ge({rigidBodyType:Ot.Static})})),e}return Xe(e,t),e}(Ft),Ze=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),$e=function(e){function i(){var i=e.call(this)||this;return i.ui=!0,i.layer="UI",i.spriteRenderer=i.addComponent((function(){return new Jt({sprite:new zt({image:st.getImage("image/ship.png"),slice:{x:32,y:0,width:16,height:24},smooth:!1,scale:new t(1.5,1.5)}),tiled:new t(3,1)})})),i}return Ze(i,e),i.prototype.start=function(){this.playerStatus=this.findGameObjectByName("Player").getComponentByName("PlayerStatus"),this.transform.position=new t(180,360)},i.prototype.update=function(){this.spriteRenderer.tiled.set(this.playerStatus.lifes,1)},i}(Ft),Je=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ti=function(e){function i(){var t=e.call(this)||this;return t.ui=!0,t.layer="UI",t.textRenderer=t.addComponent((function(){return new ee({text:"00000000",color:"#FFFFFF",fontUrl:"font/PrStart.ttf",fontFamily:"PrStart",size:20})})),t}return Je(i,e),i.prototype.start=function(){this.gameController=this.findGameObjectByName("GameController"),this.transform.position=new t(-220,360)},i.prototype.update=function(){this.textRenderer.text=this.gameController.score.toString()},i}(Ft),ei=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ii=function(e){function i(){var t=e.call(this)||this;return t.ui=!0,t.layer="UI",t.addComponent((function(){return new ee({text:"GAME OVER",color:"#FFFFFF",fontUrl:"font/PrStart.ttf",fontFamily:"PrStart",size:24,pivot:"center"})})),t}return ei(i,e),i.prototype.start=function(){this.transform.position=new t(0,0)},i}(Ft),ni=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ri=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ni(e,t),e.prototype.start=function(){this.gameCamera.layers=["Background","StageBounds","PlayerProjectile","Player","Enemy","QuadTree","UI"],this.addGameObject((function(){return new Ve}),"InputController"),this.addGameObject((function(){return new ye}),"Background"),this.addGameObject((function(){return new Ke}),"StageBounds"),this.addGameObject((function(){return new Ye}),"Player"),this.addGameObject((function(){return new De}),"EnemySpawner"),this.addGameObject((function(){return new Ge}),"GameController"),this.addGameObject((function(){return new ti}),"ScoreUI"),this.addGameObject((function(){return new $e}),"LifeCounterUI"),this.addGameObject((function(){return new ii}),"GameOverUI")},e}(Ht),oi=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ai=function(e){function i(){var i=e.call(this)||this;return i.starting=!1,i.ui=!0,i.spriteRenderer=i.addComponent((function(){return new Jt({sprite:new zt({image:st.getImage("image/ship.png"),slice:{x:32,y:0,width:16,height:24},smooth:!1,scale:new t(4,4)}),offset:new t(0,200)})})),i.addComponent((function(){return new ee({color:"#FFFFFF",text:"PRESS ENTER TO START\nPRESS Q TO QUIT\n            \nMovements: Arrows\nFire     : F\nPause    : P\nMusic    : M\n",fontUrl:"font/PrStart.ttf",fontFamily:"PrStart",size:18,lineSeparation:4,pivot:"center"})})),i}return oi(i,e),i.prototype.start=function(){this.inputController=this.findGameObjectByName("InputController"),this.transform.position=new t(0,0)},i.prototype.update=function(){if(this.spriteRenderer.rotation.degrees+=200*lt.deltaTime,!1===this.starting&&this.inputController.enter)return this.starting=!0,void ut.loadScene("GameScene");this.inputController.quit&&window.close()},i}(Ft),si=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),hi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return si(e,t),e.prototype.start=function(){this.addGameObject((function(){return new Ve}),"InputController"),this.addGameObject((function(){return new ai}),"StartMenu")},e}(Ht),ci=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ui=function(e){function i(){var t=e.call(this)||this;return t.ui=!0,t.addComponent((function(){return new ee({color:"#FFFFFF",text:"LOADING",fontUrl:"font/PrStart.ttf",fontFamily:"PrStart",size:16,lineSeparation:4,pivot:"center"})})),t}return ci(i,e),i.prototype.start=function(){this.transform.position=new t(160,-360)},i}(Ft),li=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),pi=function(t){function e(){var e=t.call(this)||this;return st.createImage("image/desert-backgorund.png"),st.createImage("image/ship.png"),st.createImage("image/enemy-small.png"),st.createImage("image/enemy-medium.png"),st.createImage("image/enemy-big.png"),st.createImage("image/laser-bolts.png"),st.createImage("image/explosion.png"),st.createAudio("audio/spaceship-shooter.mp3"),st.createAudio("audio/player-weapon.mp3"),st.createAudio("audio/player-explosion.mp3"),st.createAudio("audio/enemy-explosion.mp3"),e}return li(e,t),e.prototype.start=function(){this.addGameObject((function(){return new ui}),"LoadingUI")},e.prototype.update=function(){st.getAssetsLoaded()&&ut.loadScene("StartScene")},e}(Ht),di=new Mt({containerNode:document.getElementById("app"),gameWidth:512,gameHeight:840,debugEnabled:!1,spriteDefaultScale:new t(2,2),collisions:{debugQuadTree:!0,quadTreeBounds:new e(-260,-450,520,900),method:k.AABB}});di.addScene("LoadingScene",(function(){return new pi}),!0),di.addScene("StartScene",(function(){return new hi})),di.addScene("GameScene",(function(){return new ri})),di.run()})();